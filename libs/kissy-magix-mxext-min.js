KISSY.add("magix/body",function(e,t,n,r){n.has;var a=n.mix,i={submit:1,focusin:1,focusout:1,mouseenter:1,mouseleave:1,mousewheel:1,change:1},o=document.body,s={},c=n.cfg.tagName,u="mx-handler",f="mx-ignore",d={},l=a({processEvent:function(e){for(var t=this,n=e.target||e.srcElement;n&&1!=n.nodeType;)n=n.parentNode;var r=n,a=e.type,i=d[a]||(d[a]=RegExp("(?:^|,)"+a+"(?:,|$)"));if(!i.test(n.getAttribute(f))){for(var s,l,m="mx"+a,h=[];r&&r!=o&&(s=r.getAttribute(m),l=r.getAttribute(f),!s&&!i.test(l));)h.push(r),r=r.parentNode;if(s){var v=r.getAttribute(u)||r.getAttribute("mx-owner");if(!v)for(var p=r;p&&p!=o;){if(p.tagName.toUpperCase()==c){r.setAttribute(u,v=p.id);break}p=p.parentNode}if(!v)throw Error("miss mx-handler attribute:"+s);t.fire("event",{info:s,type:m,domEvent:e,target:n,current:r,handler:v})}else for(var g,l;h.length;)g=h.shift(),l=g.getAttribute(f),i.test(l)||(l=l?l+","+a:a,g.setAttribute(f,l))}},attachEvent:function(e){var t=this;if(s[e])s[e]++;else{s[e]=1;var n=i[e];n?t.delegateUnbubble(o,e):o["on"+e]=function(e){e=e||window.event,e&&t.processEvent(e)}}},detachEvent:function(e){var t=this,n=s[e];if(n>0)if(n--,n)s[e]=n;else{var r=i[e];r?t.undelegateUnbubble(o,e):o["on"+e]=null,delete s[e]}}},r);return n.mix(l,t)},{requires:["magix/impl/body","magix/magix","magix/event"]}),KISSY.add("magix/event",function(e,t){var n=function(e){return"~`"+e},r=t.safeExec,a={fire:function(e,t,a,i){var o=n(e),s=this,c=s[o];if(c){t||(t={}),t.type||(t.type=e);for(var u,f=c.length-1,d=f+1;d--;){u=i?d:f-d;var l=c[u];if(l.d&&(c.splice(u,1),f--),r(l,t,s)===!1)break}}a&&delete s[o]},on:function(e,r,a){var i=n(e);this[i]||(this[i]=[]),t.isNumeric(a)?this[i].splice(a,0,r):(r.d=a,this[i].push(r))},un:function(e,r){t.isArray(e)||(e=[e]);for(var a=0,i=e.length;i>a;a++){var o=n(e[a]),s=this[o];if(s)if(r){for(var c=0,u=s.length;u>c;c++)if(s[c]==r){s.splice(c,1);break}}else delete this[o]}}};return a},{requires:["magix/magix"]}),KISSY.add("magix/impl/body",function(e){return{delegateUnbubble:function(t,n){var r=this;r.$events||(r.$events={}),t=e.one(t),t.delegate(n,"*[mx"+n+"]",r.$events[n]=function(e){r.processEvent(e)})},undelegateUnbubble:function(t,n){var r=this,a=r.$events;a&&(t=e.one(t),t.undelegate(n,"*[mx"+n+"]",a[n]),delete a[n])}}},{requires:["node"]}),KISSY.add("magix/impl/magix",function(e){return{libRequire:function(t,n){var r=this;if(t){var a=r.isFunction(n),i=r.isArray(t);e.use(i?t.join(","):t,a?function(e){n.apply(e,[].slice.call(arguments,1))}:r.noop)}else n()},libEnv:function(t){var n=this,r=n.cfg;if(t){var a,i=[],o=0,s=t.progress;if(s){var c=function(){var e=i.length;e?(e>8&&i.splice(0,2),Magix.safeExec(s,i.shift(),r),setTimeout(c,15)):i.d=0},u=function(e){e!=a&&(i.push(a=e),i.d||(i.d=setTimeout(c,15)))};t.vomLoad=function(e){for(var t=Math.max(e,o);t>o;)o+=.05*Math.random(),u(o=Math.min(o,t));o=t};var f=e.getScript;e.getScript=function(){.95>=o?o+=.04*Math.random():1==o&&(e.getScript=f,i.s=1),u(o),f.apply(e,arguments)}}}else{var d=r.appHome||"./",l=location,m=l.protocol,h=r.appName||"app";if(d=d.replace(RegExp("(^|/)"+h+"/?$","i"),function(e,t){return t||"./"}),~d.indexOf(m)||(d=n.path(l.href,d)),e.endsWith(d,"/")||(d+="/"),r.appHome=d,r.debug&&(r.debug=0==d.indexOf(m+"//"+l.host)),r.debug&&1.3>Number(e.version)){var v=RegExp("("+d+h+"/.+)-min\\.js(\\?[^?]+)?");e.config({map:[[v,"$1.js$2"]]})}var p="";p=r.debug?e.now():r.appTag,p&&(p+=".js");var g=r.appCombine;e.isUndefined(g)&&(g=e.config("combine")),e.config({packages:[{name:r.appName=h,path:d,debug:r.debug,combine:g,tag:p}]})}},isArray:e.isArray,isFunction:e.isFunction,isObject:e.isObject,isRegExp:e.isRegExp,isString:e.isString,isNumber:e.isNumber}}),KISSY.add("magix/impl/router",function(e){return{useHistoryState:function(){var t=this,n=location.href;e.one(window).on("popstate",function(){var e=location.href==n;(t.$firedPop||!e)&&(t.$firedPop=!0,t.route())})},useLocationHash:function(){var t=this;e.one(window).on("hashchange",function(){t.route()})}}},{requires:["node"]}),KISSY.add("magix/impl/view",function(e,t,n,r){var a=function(){},i={wrapAsyn:1,extend:1},o=function(t,n,a){for(var i in n)e.isObject(n[i])?(r.has(t,i)||(t[i]={}),o(t[i],n[i],!0)):a&&(t[i]=n[i])};return a.extend=function(t,n){var i=this,o=function(){o.superclass.constructor.apply(this,arguments),n&&r.safeExec(n,arguments,this)};return o.extend=a.extend,e.extend(o,i,t)},a.prepare=function(e){var t=this;if(!e.wrapAsyn){for(var n in t)r.has(i,n)&&(e[n]=t[n]);for(var a,s=e.prototype,c=e;c.superclass;)a=c.superclass.constructor,o(s,a.prototype),c=a}e.wrapAsyn()},r.mix(a.prototype,{getTmplByXHR:function(e,n){t({url:e,dataType:"html",success:function(e){n(e)},error:function(e,t){n(t)}})}}),a},{requires:["ajax","sizzle","magix/magix"]}),KISSY.add("magix/magix",function(e,t){var n=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,r=/[^\/]*$/,a=/[#?].*$/,i="",o=/([^=&?\/#]+)=([^&=#?]*)/g,s="pathname",c=/^https?:\/\//i,u={},f=function(e,t){return e?Object.prototype.hasOwnProperty.call(e,t):!1},d=function(e,t,n){for(var r in t)n===!0?e[r]=t[r]:!f(t,r)||n&&f(n,r)||(e[r]=t[r]);return e},l=function(e,t,n,r,a,i){for(h.isArray(e)||(e=[e]),t&&(h.isArray(t)||t.callee)||(t=[t]),r=0;e.length>r;r++)i=e[r],a=h.isFunction(i)&&i.apply(n,t);return a},m=function(){},h={isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},mix:d,has:f,safeExec:l,noop:m,cfg:{debug:"%DEV%",tagName:"VFRAME"},locals:{},config:function(e){var t=this,n=t.cfg;return e&&(n=d(n,e)),n},start:function(e){var t=this;e=t.config(e),t.libEnv(),e.ready&&(l(e.ready),delete e.ready);var n=e.hasIniFile,r=function(r){n!==!1?t.libRequire(e.appName+"/ini",r):r()};r(function(n){t.cfg=d(e,n,e);var r={progress:t.cfg.progress,vomLoad:m};t.libEnv(r),t.libRequire(["magix/router","magix/vom"],function(n,a){n.on("locationChanged",function(e){e.slient?a.locationUpdated(e.loc):e.changed.isView()?a.remountRoot(e):a.locationChanged(e)}),a.on("progress",function(e){r.vomLoad(e.percent)}),t.libRequire(e.extensions,function(){n.start()})})})},keys:function(e){var t;if(Object.keys)t=Object.keys(e);else{t=[];for(var n in e)f(e,n)&&t.push(n)}return t},local:function(e,t){var n=arguments,r=this,a=r.locals;if(0==n.length)return a;if(1==n.length){if(!r.isObject(e))return a[e];d(a,e)}else a[e]=t},path:function(e,t){e=e.replace(a,i).replace(r,i);var o=i;if("/"==t.charAt(0)){var s=e.indexOf("://");if(-1==s)o=t;else{var c=e.indexOf("/",s+3);o=-1==c?e+t:e.substring(0,c)+t}}else o=e+t;for(;n.test(o);)o=o.replace(n,"$1/");return o},pathToObject:function(e){var t={},n={},r=i;if(a.test(e)?r=e.replace(a,i):~e.indexOf("=")||(r=e),r&&c.test(r)){var u=r.indexOf("/",8);r=-1==u?"/":r.substring(u)}return e.replace(o,function(e,t,r){n[t]=r}),t[s]=r,t.params=n,t},objectToPath:function(e){var t=e[s],n=[];for(var r in e.params)f(e.params,r)&&n.push(r+"="+e.params[r]);return t+(n.length?"?":i)+n.join("&")},tmpl:function(e,t){return 1==arguments.length?u[e]:u[e]=t}};return h.mix(h,t)},{requires:["magix/impl/magix"]}),KISSY.add("magix/router",function(e,t,n,r){var a=n.has,i=n.mix,o=document,s=/^UTF-8$/i.test(o.charset||o.characterSet||"UTF-8"),c=n.cfg,u=function(e){var t,r=this.params;n.isArray(e)||(e=(e+"").split(","));for(var i=0;e.length>i&&!(t=a(r,e[i]));i++);return t},f=function(){return a(this,b)},d=function(){return a(this,"view")},l=function(){var e=this,t=e.hash,n=e.query;return t[b]!=n[b]},m=function(e){var t=this,n=t.hash,r=t.query;return n.params[e]!=r.params[e]},h=function(e){var t=this,n=t.hash;return a(n.params,e)},v=function(e){var t=this,n=t.query;return a(n.params,e)},p=function(e){var t=this,n=t.params;return n[e]};n.safeExec;var g=window,x=encodeURIComponent,w=decodeURIComponent,y="",b="pathname",$=i({qH:{},compareObject:function(e,t){var r=[];r=r.concat(n.keys(e)),r=r.concat(n.keys(t));for(var a=0;r.length>a;a++){var i=r[a];if(e[i]!=t[i])return!1}return!0},getRoutes:function(){var e=this;if(e.$pnr)return e.$pnr;var t={routes:c.routes||{}},n=c.defaultView;if(!n)throw Error("unset defaultView");t.home=n;var r=c.defaultPathname||y;return t.routes[r]=n,t[b]=r,t.nfView=c.notFoundView,e.$pnr=t},getViewPath:function(e){var t,r=this,a=r.getRoutes();return e||(e=a[b]),t=n.isFunction(a.routes)?a.routes(e):a.routes[e],{view:t?t:a.nfView||a.home,pathname:t?e:a.nfView?e:a[b]}},start:function(){var e=this;e.supportState()?e.useHistoryState():e.useLocationHash(),e.route()},supportState:function(){var e=g.history;return c.nativeHistory&&e.pushState&&e.replaceState},parsePath:function(e){var t=n.pathToObject(e),r=t[b],a=this;return"/"!=r.charAt(0)&&c.nativeHistory&&!a.supportState()&&(t[b]=n.path(g.location[b],r)),t},parseQueryAndHash:function(e){e=e||g.location.href;var t=this,n=t.qH;if(s)try{e=w(e)}catch(r){}if(a(n,e))return n[e];var o,c=e.replace(/^[^?#]+/g,function(e){return o=t.parsePath(e)[b],y}),u=o+c.replace(/^([^#]+).*$/g,"$1"),f=c.replace(/^[^#]*#?!?/g,y),d=t.parsePath(u),x=t.parsePath(f),$={};return i($,d.params),i($,x.params),n[e]={isPathnameDiff:l,isParamDiff:m,hashParamsOwn:h,queryParamsOwn:v,get:p,originalQuery:u,originalHash:f,query:d,hash:x,params:$}},parseLocation:function(e){var t,n=this,r=n.parseQueryAndHash(e);t=c.nativeHistory?r.hash[b]?r.hash[b]:r.query[b]:r.hash[b];var a=n.getViewPath(t);return i(r,a)},getChangedLocation:function(e,t){var r={params:{}};e[b]!=t[b]&&(r[b]=!0),e.view!=t.view&&(r.view=!0);var a=n.keys(e.params);a=a.concat(n.keys(t.params));for(var i=0;a.length>i;i++){var o=a[i];e.params[o]!==t.params[o]&&(r.params[o]=!0)}return r.isParam=u,r.isPathname=f,r.isView=d,r},route:function(){var e=this,t=e.parseLocation(),n=e.$lLoc||{params:{}},r=!e.$lLoc;e.$lLoc=t;var a,i=n.view||y;if(t.view==i?e.compareLocation(n,t)||(a=!0):a=!0,a){e.$tLoc=t;var o=e.getChangedLocation(n,t);e.fire("locationChanged",{location:t,changed:o,firstFire:r})}},compareLocation:function(e,t){return e[b]!=t[b]?!1:this.compareObject(e.params,t.params)},navigate2:function(e){var t=this;if(e&&n.isString(e)){var r=t.parsePath(e);if(r[b]){if(c.nativeHistory&&!t.supportState()){var s=t.$tLoc.query;if(s&&(s=s.params))for(var u in s)a(s,u)&&!a(r.params,u)&&(r.params[u]=y)}}else{var f=i({},t.$tLoc.params);f=i(f,r.params),r.params=f,r[b]=t.$tLoc[b]}if(!t.compareLocation(r,t.$tLoc)){t.$tLoc=r;var d=n.objectToPath(r);if(t.supportState())t.$firedPop=!0,history.pushState(new Date,o.title,d),t.route();else{var l=t.parseLocation(d);t.fire("locationChanged",{loc:l,slient:!0}),location.hash="#!"+d}}}},navigate:function(e,t){if(n.isObject(e)){var r=[];for(var a in e)r.push(a+"="+(s?x(e[a]):e[a]));e=r.join("&"),t&&(e=t+"?"+e)}this.navigate2(e)}},r);return n.mix($,t)},{requires:["magix/impl/router","magix/magix","magix/event"]}),KISSY.add("magix/vframe",function(e,t,n,r){var a=document,i=0,o=window,s=o.CollectGarbage||t.noop,c=t.safeExec,u=t.mix,f=t.cfg.tagName,d="mx-view",l=function(e){return"object"==typeof e?e:a.getElementById(e)},m=function(e,t){return l(e).getElementsByTagName(t)},h=function(e){return a.createElement(e)};h(f);var v="viewLoad",p=function(e){var t=this;t.rC=0,t.rM={},t.parentAlter();var n=t.view;c(n.fire,"childrenAlter",n),t.unmountZoneVframes(0,e)},g=/<script[^>]*>[\s\S]*?<\/script>/gi,x=function(e){var t=this;t.id=x.idIt(e),t.vId=t.id+"_view",t.cS={},t.cC=0,t.view=null,t.rC=0,t.rM={}};return u(x,{idIt:function(e){return e.id||(e.id="magix_vf_"+i++)},create:function(e,t){e=l(e);var n=new x(e);return u(n,t),n},createNode:function(e,t){var n=h(f);n.id=e,t.parentNode.insertBefore(n,t)}}),u(x.prototype,n),u(x.prototype,{useAnimUpdate:function(){return!1},oldViewDestroy:t.noop,prepareNextView:t.noop,newViewCreated:t.noop,mountView:function(e,n){var a=this,i=l(a.id);i._dataBak?i._dataChged=1:(i._dataBak=1,i._dataTmpl=i.innerHTML.replace(g,""));var o=a.$vN&&a.useAnimUpdate();if(a.unmountView(o,!0),e){var s=t.pathToObject(e),c=s.pathname;a.$vN=c;var f=function(e){if(c==a.$vN){r.prepare(e);var t;o?(t=a.vId,a.prepareNextView()):t=a.id;var f=new e({$:l,path:c,owner:a,ownerVOM:a.owner,id:t,vId:a.vId,vfId:a.id,location:a.owner.getLocation()});f.on("interact",function(e){a.fire(v,{view:f},a.vced=!0),o&&a.newViewCreated(!0),e.tmpl||(!o&&i._dataChged&&(i.innerHTML=i._dataTmpl),a.mountZoneVframes()),f.on("rendered",function(){a.mountZoneVframes()}),f.on("prerender",function(e){p.call(a,e.anim)})},0),a.view=f;var d=a.owner.getVframe(a.pId);d&&d.view&&(s.params.view=d.view),f.load(u(s.params,n,!0))}};t.libRequire(c,f)}},unmountView:function(e,t){var n=this,n=this;if(n.view){p.call(n,e),n.view.destroy(),n.vced=!1;var r=l(n.id);!e&&r._dataBak&&(r.innerHTML=r._dataTmpl),e&&t&&n.oldViewDestroy(),s(),delete n.view,delete n.viewName}else n.viewName&&(n.un(v),delete n.viewName)},mountZoneVframes:function(e,n,r){var a,i=this,o=i.owner;a=e?l(e):l(i.vId)||l(i.id);var s=m(a,f),c=s.length;if(c)for(var u,h,v=0;c>v;v++)u=s[v],h=u.getAttribute(d),u=x.create(u,{owner:i.owner,pId:i.id}),t.has(i.cS,u.id)||i.cC++,i.cS[u.id]=r,u.mountView(h,n),o.add(u);else i.childrenCreated()},unmountZoneVframes:function(e,n){var r,a=this;r=e?m(e,f):t.keys(a.cS);for(var i,o,s=0,c=r.length;c>s;s++)o=r[s],e&&(o=o.id),o&&(i=a.owner.getVframe(o),i.unmountView(n),a.owner.remove(o),l(o).id="",delete a.cS[o],a.cC--);e||(a.cS={},a.cC=0)},locationChanged:function(e){var n=this,r=n.view;if(r&&r.sign&&(r.location=e.location,r.rendered)){var a=r.olChanged(e),i=u({prevent:function(){this.cs=[]},toChildViews:function(e){e=e||[],t.isString(e)&&(e=e.split(",")),this.cs=e}},e);a&&c(r.locationChange,i,r);for(var o,s=i.cs||t.keys(n.cS),f=0,d=s.length,l=n.owner;d>f;f++)o=l.getVframe(s[f]),o&&o.locationChanged(e)}},locationUpdated:function(e){var n=this,r=n.view;if(r&&r.sign){r.location=e;var a,i=n.cS,o=n.owner;for(var s in i)t.has(i,s)&&(a=o.getVframe(s),a&&a.locationUpdated(e))}},childrenCreated:function(){var e=this,t=e.view;t&&!e.fcc&&(e.fcc=1,t.fire("childrenCreated"),e.fire("childrenCreated")),e.owner.childCreated(),e.parentAlter(!0)},parentAlter:function(e){var n=this,r=n.pId;if(r){var a=n.owner.getVframe(r);if(e)t.has(a.rM,n.id)||(a.rM[n.id]=a.cS[n.id],a.rC++,a.rC==a.cC&&(delete a.fca,a.childrenCreated()));else if(t.has(a.rM,n.id)){var i=a.rM[n.id];delete a.rM[n.id],a.rC--,i||a.fca||(a.fca=1,delete a.fcc,a.view.fire("childrenAlter"),a.fire("childrenAlter")),i||a.parentAlter(e)}}}}),x},{requires:["magix/magix","magix/event","magix/view"]}),KISSY.add("magix/view",function(e,t,n,r,a){var i=1,o=n.safeExec,s=n.has,c=",",u=[],f=n.cfg,d={render:1,renderUI:1,updateUI:1},l="~~",m=function(e){return function(){var t,n=this;return n.sign&&(n.sign++,n.fire("asyncall"),t=e.apply(n,arguments),n.fire("asyncalled")),t}},h=function(e){var t=this;n.mix(t,e),t.sign=1};h.prototype,n.mix(h,{idIt:function(e){return e.id||(e.id="magix_mxe_"+i++)},wrapAsyn:function(){var e=this;if(!e[l]){e[l]=1;var t,r=e.prototype;for(var a in r){t=r[a];var i=null;n.isFunction(t)&&t!=n.noop&&!t[l]&&s(d,a)&&(i=m(t),i[l]=t,r[a]=i)}}}});var v=h.prototype,p=window.CollectGarbage||n.noop,g=/\smx[a-z]+\s*=/g;return n.mix(v,r),n.mix(v,{render:n.noop,locationChange:n.noop,init:n.noop,hasTemplate:!0,enableEvent:!0,enableAnim:!1,load:function(){var e=this,t=e.hasTemplate,n=arguments,r=function(){e.delegateEvents(),e.fire("interact",{tmpl:t},!0),o(e.init,n,e),o(e.render,u,e);var r=!t&&!e.rendered;r&&(e.rendered=!0,e.fire("created",null,!0))};if(t){var a=e.sign;e.getTemplate(function(t){a==e.sign&&(e.template=t,r())})}else r()},updateViewId:function(){var e=this;e.id=e.$(e.vId)?e.vId:e.vfId},beginUpdateHTML:function(){var e=this;if(e.sign){var t=e.rendered;if(t){var n=e.enableAnim;e.fire("prerender",{anim:n});var r=e.owner;n&&(o(r.oldViewDestroy,u,r),o(r.prepareNextView,u,r),e.updateViewId())}}},endUpdateHTML:function(){var e=this;e.sign&&(e.rendered&&e.enableAnim&&o(owner.newViewCreated,u,owner),e.rendered||e.fire("created",null,!0),e.rendered=!0,e.fire("rendered"),p())},wrapMxEvent:function(e){return e?(e+"").replace(g,' mx-owner="'+this.vfId+'"$&'):e},setViewHTML:function(e){var t=this;t.beginUpdateHTML(),t.$(t.id).innerHTML=t.wrapMxEvent(e),t.endUpdateHTML()},observeLocation:function(e){var t=this;t.$loc||(t.$loc={}),n.isString(e)?t.$loc.keys=e.split(c):n.isArray(e)?t.$loc.keys=e:n.isObject(e)&&(t.$loc.pn=e.pathname,t.observeLocation(e.keys))},olChanged:function(e){var t=this,n=t.$loc,r=e.changed;if(n){var a=!1;if(n.pn&&(a=r.isPathname()),!a){var i=n.keys;a=r.isParam(i)}return a}return!0},destroy:function(){var e=this;e.fire("destroy",null,!0,!0),e.delegateEvents(!0),e.sign=0},getTemplate:function(e){var t=this;if(t.template)e(t.template);else{var r=n.tmpl(t.path);if(r)e(r);else{var a=f.debug,i=".html",o=f.appHome+t.path+i;a&&(o+="?_="+(new Date).getTime()+i),t.getTmplByXHR(o,function(r){e(n.tmpl(t.path,r))})}}},processEvent:function(e){var t=this;if(t.enableEvent&&t.sign){var n=e.target,r=e.current,a=e.info;e.type;var i=e.domEvent;if(a){var s,c=a.split(":"),u=c.shift(),f=c[c.length-1];("_halt_"==f||"_stop_"==f)&&(i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,s=!0),("_halt_"==f||"_prevent_"==f)&&(i.preventDefault?i.preventDefault():i.returnValue=!1,s=!0),s&&c.pop();for(var d,l=h.idIt(r),m=t.events,v=m[i.type],p=0;c.length>p;p++)d=c[p].lastIndexOf("@"),d>-1&&(c[c[p].substring(d+1)]=c[p].substring(0,d));v[u]&&o(v[u],{view:t,currentId:l,targetId:h.idIt(n),domEvent:i,events:m,params:c},v)}}},delegateEvents:function(e){var t=this,n=t.events,r=e?a.detachEvent:a.attachEvent;for(var i in n)r.call(a,i)},mountZoneViews:function(e,t,n){this.owner.mountZoneVframes(e,t,n!==!1)},unmountZoneViews:function(e){this.owner.unmountZoneVframes(e)},mountView:function(e,t,n){var r=this,a=r.ownerVOM,i=a.getVframe(e);return i&&i.mountView(t,n),i}}),n.mix(h,t,{prototype:!0}),n.mix(h.prototype,t.prototype),h},{requires:["magix/impl/view","magix/magix","magix/event","magix/body"]}),KISSY.add("magix/vom",function(e,t,n,r,a){var i=document;n.safeExec;var o,s="magix_vf_root",c=n.has,u=0,f=0,d=0,l=0,m={},h=n.mix({add:function(e){c(m,e.id)||(u++,m[e.id]=e,h.fire("add",{vframe:e}))},getVframe:function(e){return m[e]},remove:function(e){var t=n.isString(e)?e:e.id,e=m[t];e&&(u--,delete m[t],h.fire("remove",{vframe:e}))},childCreated:function(){if(!l){f++;var e=f/u;e>d&&(h.fire("progress",{percent:d=e}),1==e&&(l=1,h.un("progress")))}},getRoot:function(){var e=h.getVframe(s);if(!e){var n=i.getElementById(s);n||t.createNode(s,i.body.firstChild),e=t.create(s,{owner:h}),h.add(e)}return e},remountRoot:function(e){var t=h.getRoot();o=e.location,t.mountView(o.view)},locationChanged:function(e){o=e.location;var t=h.getRoot();t.locationChanged(e)},locationUpdated:function(e){o=e;var t=h.getRoot();t.locationUpdated(e)},getLocation:function(){return o}},r);return a.on("event",function(e){var t=h.getVframe(e.handler);t&&t.view&&t.view.processEvent(e)}),h},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]}),KISSY.add("mxext/mmanager",function(e,t){var n=t.has,r=t.safeExec,a=function(e){t.isArray(e)||(e=[e]);for(var n,r=0;e.length>r;r++)n=e[r],delete n.cacheKey;return e},i=function(e){var t=this;t.$modelClass=e},o=Array.prototype.slice,s={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},c=function(e){var t={};for(var n in e)s[n]||(t[n]=e[n]);return t},u=function(e,t){var n=o.call(arguments,2);return function(){return e.apply(t,n.concat(o.call(arguments)))}};t.mix(i,{create:function(e){if(!e)throw Error("MManager.create modelClass ungiven");return new i(e)}});var f={ALL:1,ANY:2,ONE:4},d=function(e){this.$host=e,this.$task=!1};return t.mix(d.prototype,{create:function(t){var a=this,i=a.$host;e.isString(t)&&(t={name:t});var o=i[t.name];if(!o)throw Error("Not found:"+t.name);var s,u=t.cacheKey||o.cacheKey,f=t.cacheTime||o.cacheTime||0;i.$modelsCache||(i.$modelsCache={});var d,l=i.$modelsCache,m=t.metaParams||[];return u&&n(l,u)?(s=l[u],f>0&&e.now()-s._doneAt>f&&(delete l[u],d=!0)):(s=new i.$modelClass(c(o)),s._after=o.after,s._cacheKey=u,s._meta=o,d=!0),s.metaParams=m,d&&(s.reset(),s.set(c(t)),s.setUrlParams(o.urlParams),s.setPostParams(o.postParams),s.setUrlParams(t.urlParams),s.setPostParams(t.postParams),e.isFunction(o.before)&&r(o.before,[s].concat(m),o)),{entity:s,needUpdate:d}},fetchModels:function(a,i,o,s,c){var d=this;if(d.$task)return d.next(function(e){e.fetchModels(a,i,o,s,c)}),d;d.$task=!0;var l=d.$host;l.$modelsCache||(l.$modelsCache={}),l.$modelsCacheKeys||(l.$modelsCacheKeys={}),d.$reqModels||(d.$reqModels={});var m=l.$modelsCache,h=l.$modelsCacheKeys,v=d.$reqModels;t.isArray(a)||(a=[a]);for(var p,g,x,w=a.length,y=0,b=[],$=function(t,a,u,l){if(!d.$destroy){y++,delete v[u.id];var x,$,M=u._cacheKey;if(a)p=l||"fetch data error @ mxext/mmanager line 199",c==f.ONE&&(u.set("msg",p),o&&(x=r(o,u)),$=!1);else{g=!0,b[t]=u,M&&!n(m,M)&&(m[M]=u);var S=u.metaParams;u._doneAt=e.now(),u._after&&r(u._after,[u].concat(S),u._meta),c==f.ONE&&(i&&(x=r(i,u)),$=!0)}if(M&&n(h,M)){var E=h[M];delete h[M],r(E,[a,u,l],u)}if(y>=w){if(c!=f.ONE){var C=p?o:i,l=p?[p]:b;$=!p,c==f.ANY&&(C=g?i:o,l=g?b:[p],$=g),x=r(C,l,d)}d.$ntId=setTimeout(function(){d.$task=!1,d.doNext(x,$)},30)}s&&r(s,{total:w,current:y,error:p})}},M=0;a.length>M;M++){x=a[M];var S,E,C=x.cacheKey;C&&n(h,C)?h[C].push(u($,d,M)):(E=d.create(x),S=E.entity,E.needUpdate?(v[S.id]=S,C&&(h[C]=[]),S.request({success:u($,S,M,!1,S),error:u($,S,M,!0,S)})):$(M,!1,S))}return d},fetchAll:function(e,t,n,r){return this.fetchModels(e,t,n,r,f.ALL)},saveAll:function(e,t,n,r){return e=a(e),this.fetchModels(e,t,n,r,f.ALL)},saveAny:function(e,t,n,r){return e=a(e),this.reqModels(e,t,n,r,f.ANY)},fetchAny:function(e,t,n,r){return this.reqModels(e,t,n,r,f.ANY)},saveOne:function(e,t,n,r){return e=a(e),this.reqModels(e,t,n,r,f.ONE)},fetchOne:function(e,t,n,r){return this.fetchModels(e,t,n,r,f.ONE)},abort:function(){var e=this;clearTimeout(e.$ntId);var t=e.$host,a=e.$reqModels,i=t.$modelsCacheKeys;if(a)for(var o in a){var s=a[o],c=s._cacheKey;if(c&&n(i,c)){var u=i[c];delete i[c],r(u,[!0,s,"aborted"],s)}s.abort()}e.$reqModels={},e.$queue=[],e.$task=!1},next:function(e){var t=this;if(t.$queue||(t.$queue=[]),t.$queue.push(e),!t.$task){var n=t.$latest||[null,!0];t.doNext.apply(t,n)}return t},doNext:function(e,t){var n=this,a=n.$queue;if(a){var i=a.shift();i&&r(i,[n,e,t],n)}n.$latest=[e,t]},destroy:function(){var e=this;e.$destroy=!0,e.abort()}}),t.mix(i.prototype,{registerModels:function(e){var n=this;t.isArray(e)||(e=[e]);for(var r,a=0;e.length>a;a++){if(r=e[a],!r.name)throw Error("model must own a name attribute");n[r.name]=r}},registerMethods:function(e){var a=this;for(var i in e)n(e,i)&&(a[i]=function(e){return function(){for(var n,i,o=arguments,s=[],c=0;o.length>c;c++)i=o[c],t.isFunction(i)?s.push(function(e){return function(){n||e.apply(e,arguments)}}(i)):s.push(i);var u=e.apply(a,s);return{abort:function(){u&&u.abort&&r(u.abort,["aborted"],u),n=!0}}}}(e[i]))},callMethods:function(t,n,r){for(var a,i,o=this,s=[],c="",u=t.length,f=0,d=function(t,i,o){a||(f++,o?c=t:s[i]=t,f>=u&&(c?e.isFunction(r)&&r(c):e.isFunction(n)&&n.apply(n,s)))},l=function(e,t){return function(n){d(n,e,!t)}},m=0;t.length>m;m++){i=t[m];var h;h=e.isFunction(i.name)?i.name:o[i.name],h?(i.params||(i.params=[]),e.isArray(i.params)||(i.params=[i.params]),i.params.push(l(m,!0),l(m)),h.apply(o,i.params)):d("unfound:"+i.name,m,!0)}return{abort:function(){a=!0}}},saveAll:function(e,t,n,r){return new d(this).saveAll(e,t,n,r)},fetchAll:function(e,t,n,r){return new d(this).fetchAll(e,t,n,r)},saveAny:function(e,t,n,r){return new d(this).saveAny(e,t,n,r)},fetchAny:function(e,t,n,r){return new d(this).fetchAny(e,t,n,r)},saveOne:function(e,t,n,r){return new d(this).saveOne(e,t,n,r)},fetchOne:function(e,t,n,r){return new d(this).fetchOne(e,t,n,r)},clearCacheByKey:function(t){var r=this,a=r.$modelsCache;if(a)if(e.isString(t))n(a,t)&&delete a[t];else if(e.isRegExp(t))for(var i in a)t.test(i)&&delete modelClass[i]},clearCacheByName:function(t){var n,r=this,a=r.$modelsCache;if(n=e.isRegExp(t)?function(e){return t.test(e)}:function(e){return e==t},a)for(var i in a){var o=a[i],s=o._meta;n(s.name)&&delete a[i]}},getModelUrl:function(t){var n,r=this;return n=e.isString(t)?r[t]:t,r.$modelClass.prototype.url(n.uri)}}),i},{requires:["magix/magix"]}),KISSY.add("mxext/model",function(e,t){var n=function(r,a,i){for(var o in a)e.isObject(a[o])?(t.has(r,o)||(r[o]={}),n(r[o],a[o],!0)):i&&(r[o]=a[o])},r=function(t){t&&this.set(t),this.id=e.guid("m")},a=function(r,a){var i=function(){i.superclass.constructor.apply(this,arguments),a&&t.safeExec(a,[],this)};return t.mix(i,this,{prototype:!0}),n(r,this.prototype),e.extend(i,this,r)};return t.mix(r,{GET:"GET",POST:"POST",extend:a}),t.mix(r.prototype,{urlMap:{},sync:t.noop,parse:t.noop,getParamsObject:function(e){return e||(e=r.GET),this["$"+e]||null},getUrlParamsObject:function(){return this.getParamsObject(r.GET)},getPostParamsObject:function(){return this.getParamsObject(r.POST)},getPostParams:function(){return this.getParams(r.POST)},getUrlParams:function(){return this.getParams(r.GET)},getParams:function(t){var n=this;t=t?t.toUpperCase():r.GET;var a,i="$"+t,o=n[i],s=[];if(o)for(var c in o)if(a=o[c],e.isArray(a))for(var u=0;a.length>u;u++)s.push(c+"="+encodeURIComponent(a[u]));else s.push(c+"="+encodeURIComponent(a));return s.join("&")},setUrlParamsIf:function(e,t){this.setParams(e,t,r.GET,!0)},setPostParamsIf:function(e,t){var n=this;n.setParams(e,t,r.POST,!0)},setParams:function(t,n,a,i){a=a?a.toUpperCase():r.GET;var o=this;o.$keysCache||(o.$keysCache={}),o.$keysCache[a]=!0;var s="$"+a;if(o[s]||(o[s]={}),e.isObject(t))for(var c in t)i&&o[s][c]||(o[s][c]=t[c]);else t&&n&&(i&&o[s][t]||(o[s][t]=n))},setPostParams:function(e,t){var n=this;n.setParams(e,t,r.POST)},setUrlParams:function(e,t){this.setParams(e,t,r.GET)},removeParamsObject:function(e){e||(e=r.GET),delete this["$"+e]},removePostParamsObject:function(){this.removeParamsObject(r.POST)},removeUrlParamsObject:function(){this.removeParamsObject(r.GET)},reset:function(){var e=this,n=e.$keysCache;if(n){for(var r in n)t.has(n,r)&&delete e["$"+r];delete e.$keysCache}var a=e.$keys,i=e.$attrs;if(a){for(var o=0;a.length>o;o++)delete i[a[o]];delete e.$keys}},url:function(e){var t,n=this,r=e||n.get("uri");if(!r)throw Error("model not set uri");t=r.split(":");var a=n.urlMap;if(a)for(var i=0,o=a,s=t.length;s>i&&(o=o[t[i]],void 0!==o);i++)i==s-1&&(r=o);return r},get:function(e){var t=this,n=t.$attrs;return n?n[e]:null},set:function(t,n,r){var a=this;if(a.$attrs||(a.$attrs={}),r&&!a.$keys&&(a.$keys=[]),e.isObject(t))for(var i in t)r&&a.$keys.push(i),a.$attrs[i]=t[i];else t&&(r&&a.$keys.push(t),a.$attrs[t]=n)},load:function(e){this.request(e)},save:function(e){this.request(e)},request:function(t){t||(t={});var n=t.success,r=t.error,a=this;a.$abort=!1,t.success=function(t){if(!a.$abort){if(t){var r=a.parse(t);r&&(e.isArray(r)&&(r={list:r}),a.set(r,null,!0))}n&&n.apply(this,arguments)}},t.error=function(){a.$abort||r&&r.apply(this,arguments)},a.$trans=a.sync(t)},abort:function(){var e=this;e.$trans&&e.$trans.abort&&e.$trans.abort(),delete e.$trans,e.$abort=!0},beginTransaction:function(){var t=this;t.$bakAttrs=e.clone(t.$attrs)},rollbackTransaction:function(){var e=this,t=e.$bakAttrs;t&&(e.$attrs=t,delete e.$bakAttrs)},endTransaction:function(){delete this.$bakAttrs}}),r},{requires:["magix/magix"]}),KISSY.add("mxext/view",function(e,t,n,r){var a,i=window,o=",",s="destroy,abort,stop,cancel,remove".split(o),c=0,u=Magix.safeExec,f=Magix.has,d={},l=function(e){if(!l.d){l.d=1,e.on("add",function(e){var t=e.vframe,n=d[t.id];if(n){for(var r=0;n.length>r;r++)m(t,n[r]);delete d[t.id]}}),e.on("remove",function(e){delete d[e.vframe.id]});var t=e.buildRoot();t.on("childrenCreated",function(){d={}})}},m=function(e,t){var n=e.view;n&&e.vced?u(n.receiveMessage,t,n):e.on("viewLoad",function(e){u(e.view.receiveMessage,t,e.view)})};return t.extend({queryEvents:null,navigate:function(e){n.navigate(e)},attachQueryEvents:function(){var n=this,r=n.queryEvents;if(r){n.$queryEventsCache={};for(var a in r){var i=r[a];for(var o in i)e.all("#"+n.id+" "+o).on(a,n.$queryEventsCache[a+"_"+o]=function(e){return function(a){if(n.enableEvent){var i=t.idIt(a.target),o=t.idIt(a.currentTarget);Magix.safeExec(e,{view:n,targetId:i,currentId:o,queryEvents:r,domEvent:a},r)}}}(i[o]))}}},detachQueryEvents:function(){var t=this,n=t.queryEvents;if(n){for(var r in n){var a=n[r];for(var i in a)e.all("#"+t.id+" "+i).detach(r,t.$queryEventsCache[r+"_"+i])}delete t.$queryEventsCache}},setData:function(e){this.data=this.wrapMustachData(e)},wrapMustachData:function(e){var t,n,r=this,a=this.renderer;if(a)for(t in a)for(n in a[t])(function(){var i=t,o=n,s=a[i][o];e[i+"_"+o]=function(){return s.call(this,r,i)}})();return e},manage:function(e,t){var n=this,r=arguments,a=!0;1==r.length&&(t=e,e="res_"+c++,a=!1),n.$resCache||(n.$resCache={});var i={hasKey:a,res:t};return n.$resCache[e]=i,t},getManaged:function(e){var t=this,n=t.$resCache;if(t.sign,n&&f(n,e)){var r=n[e],a=r.res;return a}return null},removeManaged:function(e){var t=this,n=null,r=t.$resCache;if(r)if(f(r,e))n=r[e].res,delete r[e];else for(var a in r)if(r[a].res===e){n=r[a].res,delete r[a];break}return n},destroyManaged:function(t){var n=this,r=n.$resCache;if(r){for(var a in r){var o=r[a],c=o.res;if(Magix.isNumber(c))i.clearTimeout(c),i.clearInterval(c);else if(c)if(c.nodeType&&c.parentNode)e.one(c).remove();else for(var f=0;s.length>f;f++)Magix.isFunction(c[s[f]])&&u(c[s[f]],[],c);t&&!o.hasKey&&delete r[a]}t||delete n.$resCache}},destroyAsyncall:function(){var e=this,t=e.$resCache;if(t)for(var n in t){var r=t[n],a=r.res;a.fetchOne&&a.fetchAll?(a.destroy(),delete t[n]):Magix.isNumber(a)&&(i.clearTimeout(a),i.clearInterval(a),delete t[n])}},receiveMessage:Magix.noop,postMessageTo:function(e,t){var n=this.ownerVOM;l(n),Magix.isArray(e)||(e=[e]),t||(t={});for(var r,a=0;e.length>a;a++){r=e[a];var i=n.get(r);i?m(i,t):(d[r]||(d[r]=[]),d[r].push(t))}},setViewPagelet:function(t,n){var r=this,i=r.sign,o=function(t){a?t(a):e.use("brix/core/pagelet",function(e,n){t(a=n)})},s=r.getManaged("pagelet");s?s.ready(function(){s.setChunkData(t)}):o(function(a){i==r.sign&&(e.one("#"+r.id).html(""),r.beginUpdateHTML(),s=new a({container:"#"+r.id,tmpl:r.wrapMxEvent(r.template),data:r.wrapMustachData(t),destroyAction:"empty"}),r.endUpdateHTML(),r.manage("pagelet",s),n&&(s.on("beforeRefreshTmpl",function(e){r.unmountZoneViews(e.node[0])}),s.ready(function(){i==r.sign&&n.call(r,s)})))})}},function(){var e=this;e.vm=new r,e.on("interact",function(){e.on("asyncall",function(){e.destroyAsyncall()}),e.on("prerender",function(){e.destroyManaged(!0),e.detachQueryEvents()}),e.on("rendered",function(){e.attachQueryEvents()}),e.on("destroy",function(){e.destroyManaged()})})})},{requires:["magix/view","magix/router","mxext/viewmodel"]}),KISSY.add("mxext/viewmodel",function(e){var t=function(e){t.superclass.constructor.call(this,e),this.addAttrs(e)};return e.extend(t,e.Base,{registerDataKey:function(e){for(var t={},n=0;e.length>n;n++)t[e[n]]={};this.addAttrs(t)},registerHelpers:function(e){var t=this.constructor.superclass.set;for(var n in e)t.call(this,n,e[n],{slient:!0})},toJSON:function(){return this.getAttrVals()},set:function(t,n,r){var a=t;e.isPlainObject(a)||(a={},a[t]=n);for(var i in a)if(!this.hasAttr(i))throw Error("The DataKey: '"+i+"' has not been registed in current ViewModel!");return this.constructor.superclass.set.call(this,t,n,r)}}),t},{requires:["base"]}),function(e){var t=function(){};e.console||(e.console={log:t,warn:t,error:t,debug:t});var n;e.Magix||(e.Magix={start:function(e){n=e}},KISSY.use("magix/magix",function(t,r){e.Magix=r,n&&r.start(n)}))}(this);