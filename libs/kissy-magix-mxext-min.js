KISSY.add("magix/body",function(e,t,r,n){r.has;var a=r.mix,i={submit:1,focusin:1,focusout:1,mouseenter:1,mouseleave:1,mousewheel:1,change:1},o=document.body,s={},c=r.cfg.tagName,u="mx-handler",f="mx-ignore",d={},l=a({processEvent:function(e){for(var t=this,r=e.target||e.srcElement;r&&1!=r.nodeType;)r=r.parentNode;var n=r,a=e.type,i=d[a]||(d[a]=RegExp("(?:^|,)"+a+"(?:,|$)"));if(!i.test(r.getAttribute(f))){for(var s,l,m="mx"+a,h=[];n&&n!=o&&(s=n.getAttribute(m),l=n.getAttribute(f),!s&&!i.test(l));)h.push(n),n=n.parentNode;if(s){var v=n.getAttribute(u)||n.getAttribute("mx-owner");if(!v)for(var p=n;p&&p!=o;){if(p.tagName.toUpperCase()==c){n.setAttribute(u,v=p.id);break}p=p.parentNode}if(!v)throw Error("miss mx-handler attribute:"+s);t.fire("event",{info:s,type:m,domEvent:e,target:r,current:n,handler:v})}else for(var g,l;h.length;)g=h.shift(),l=g.getAttribute(f),i.test(l)||(l=l?l+","+a:a,g.setAttribute(f,l))}},attachEvent:function(e){var t=this;if(s[e])s[e]++;else{s[e]=1;var r=i[e];r?t.delegateUnbubble(o,e):o["on"+e]=function(e){e=e||window.event,e&&t.processEvent(e)}}},detachEvent:function(e){var t=this,r=s[e];if(r>0)if(r--,r)s[e]=r;else{var n=i[e];n?t.undelegateUnbubble(o,e):o["on"+e]=null,delete s[e]}}},n);return r.mix(l,t)},{requires:["magix/impl/body","magix/magix","magix/event"]}),KISSY.add("magix/event",function(e,t){var r=function(e){return"~`"+e},n=t.safeExec,a={fire:function(e,t,a,i){var o=r(e),s=this,c=s[o];if(c){t||(t={}),t.type||(t.type=e);for(var u,f=c.length-1,d=f+1;d--;){u=i?d:f-d;var l=c[u];if(l.d&&(c.splice(u,1),f--),n(l,t,s)===!1)break}}a&&delete s[o]},on:function(e,n,a){var i=r(e);this[i]||(this[i]=[]),t.isNumeric(a)?this[i].splice(a,0,n):(n.d=a,this[i].push(n))},un:function(e,n){t.isArray(e)||(e=[e]);for(var a=0,i=e.length;i>a;a++){var o=r(e[a]),s=this[o];if(s)if(n){for(var c=0,u=s.length;u>c;c++)if(s[c]==n){s.splice(c,1);break}}else delete this[o]}}};return a},{requires:["magix/magix"]}),KISSY.add("magix/impl/body",function(e){return{delegateUnbubble:function(t,r){var n=this;n.$events||(n.$events={}),t=e.one(t),t.delegate(r,"*[mx"+r+"]",n.$events[r]=function(e){n.processEvent(e)})},undelegateUnbubble:function(t,r){var n=this,a=n.$events;a&&(t=e.one(t),t.undelegate(r,"*[mx"+r+"]",a[r]),delete a[r])}}},{requires:["node"]}),KISSY.add("magix/impl/magix",function(e){return{libRequire:function(t,r){var n=this;if(t){var a=n.isFunction(r),i=n.isArray(t);e.use(i?t.join(","):t,a?function(e){r.apply(e,[].slice.call(arguments,1))}:n.noop)}else r()},libEnv:function(t){var r=this,n=r.cfg;if(t){var a,i=[],o=0,s=t.progress;if(s){var c=function(){var e=i.length;e?(e>8&&i.splice(0,2),Magix.safeExec(s,i.shift(),n),setTimeout(c,15)):i.d=0},u=function(e){e!=a&&(i.push(a=e),i.d||(i.d=setTimeout(c,15)))};t.vomLoad=function(e){for(var t=Math.max(e,o);t>o;)o+=.05*Math.random(),u(o=Math.min(o,t));o=t};var f=e.getScript;e.getScript=function(){.95>=o?o+=.04*Math.random():1==o&&(e.getScript=f,i.s=1),u(o),f.apply(e,arguments)}}}else{var d=n.appHome||"./",l=location,m=l.protocol,h=n.appName||"app";if(d=d.replace(RegExp("(^|/)"+h+"/?$","i"),function(e,t){return t||"./"}),~d.indexOf(m)||(d=r.path(l.href,d)),e.endsWith(d,"/")||(d+="/"),n.appHome=d,n.debug&&(n.debug=0==d.indexOf(m+"//"+l.host)),n.debug&&1.3>Number(e.version)){var v=RegExp("("+d+h+"/.+)-min\\.js(\\?[^?]+)?");e.config({map:[[v,"$1.js$2"]]})}var p="";p=n.debug?e.now():n.appTag,p&&(p+=".js");var g=n.appCombine;e.isUndefined(g)&&(g=e.config("combine")),e.config({packages:[{name:n.appName=h,path:d,debug:n.debug,combine:g,tag:p}]})}},isArray:e.isArray,isFunction:e.isFunction,isObject:e.isObject,isRegExp:e.isRegExp,isString:e.isString,isNumber:e.isNumber}}),KISSY.add("magix/impl/router",function(e){return{useHistoryState:function(){var t=this,r=location.href;e.one(window).on("popstate",function(){var e=location.href==r;(t.$firedPop||!e)&&(t.$firedPop=!0,t.route())})},useLocationHash:function(){var t=this;e.one(window).on("hashchange",function(){t.route()})}}},{requires:["node"]}),KISSY.add("magix/impl/view",function(e,t,r,n){var a=function(){},i={wrapAsyn:1,extend:1},o=function(t,r,a){for(var i in r)e.isObject(r[i])?(n.has(t,i)||(t[i]={}),o(t[i],r[i],!0)):a&&(t[i]=r[i])};return a.extend=function(t,r){var i=this,o=function(){o.superclass.constructor.apply(this,arguments),r&&n.safeExec(r,arguments,this)};return o.extend=a.extend,e.extend(o,i,t)},a.prepare=function(e){var t=this;if(!e.wrapAsyn){for(var r in t)n.has(i,r)&&(e[r]=t[r]);for(var a,s=e.prototype,c=e;c.superclass;)a=c.superclass.constructor,o(s,a.prototype),c=a}e.wrapAsyn()},n.mix(a.prototype,{getTmplByXHR:function(e,r){t({url:e,dataType:"html",success:function(e){r(e)},error:function(e,t){r(t)}})}}),a},{requires:["ajax","sizzle","magix/magix"]}),KISSY.add("magix/magix",function(e,t){var r=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,n=/[^\/]*$/,a=/[#?].*$/,i="",o=/([^=&?\/#]+)=([^&=#?]*)/g,s="pathname",c=/^https?:\/\//i,u={},f=function(e,t){return e?Object.prototype.hasOwnProperty.call(e,t):!1},d=function(e,t,r){for(var n in t)r===!0?e[n]=t[n]:!f(t,n)||r&&f(r,n)||(e[n]=t[n]);return e},l=function(e,t,r,n,a,i){for(h.isArray(e)||(e=[e]),t&&(h.isArray(t)||t.callee)||(t=[t]),n=0;e.length>n;n++)i=e[n],a=h.isFunction(i)&&i.apply(r,t);return a},m=function(){},h={isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},mix:d,has:f,safeExec:l,noop:m,cfg:{debug:"%DEV%",tagName:"VFRAME"},locals:{},config:function(e){var t=this,r=t.cfg;return e&&(r=d(r,e)),r},start:function(e){var t=this;e=t.config(e),t.libEnv(),e.ready&&(l(e.ready),delete e.ready);var r=e.hasIniFile,n=function(n){r!==!1?t.libRequire(e.appName+"/ini",n):n()};n(function(r){t.cfg=d(e,r,e);var n={progress:t.cfg.progress,vomLoad:m};t.libEnv(n),t.libRequire(["magix/router","magix/vom"],function(r,a){r.on("locationChanged",function(e){e.slient?a.locationUpdated(e.loc):e.changed.isView()?a.remountRoot(e):a.locationChanged(e)}),a.on("progress",function(e){n.vomLoad(e.percent)}),t.libRequire(e.extensions,function(){r.start()})})})},keys:function(e){var t;if(Object.keys)t=Object.keys(e);else{t=[];for(var r in e)f(e,r)&&t.push(r)}return t},local:function(e,t){var r=arguments,n=this,a=n.locals;if(0==r.length)return a;if(1==r.length){if(!n.isObject(e))return a[e];d(a,e)}else a[e]=t},path:function(e,t){e=e.replace(a,i).replace(n,i);var o=i;if("/"==t.charAt(0)){var s=e.indexOf("://");if(-1==s)o=t;else{var c=e.indexOf("/",s+3);o=-1==c?e+t:e.substring(0,c)+t}}else o=e+t;for(;r.test(o);)o=o.replace(r,"$1/");return o},pathToObject:function(e){var t={},r={},n=i;if(a.test(e)?n=e.replace(a,i):~e.indexOf("=")||(n=e),n&&c.test(n)){var u=n.indexOf("/",8);n=-1==u?"/":n.substring(u)}return e.replace(o,function(e,t,n){r[t]=n}),t[s]=n,t.params=r,t},objectToPath:function(e){var t=e[s],r=[];for(var n in e.params)f(e.params,n)&&r.push(n+"="+e.params[n]);return t+(r.length?"?":i)+r.join("&")},tmpl:function(e,t){return 1==arguments.length?u[e]:u[e]=t}};return h.mix(h,t)},{requires:["magix/impl/magix"]}),KISSY.add("magix/router",function(e,t,r,n){var a=r.has,i=r.mix,o=document,s=/^UTF-8$/i.test(o.charset||o.characterSet||"UTF-8"),c=r.cfg,u=function(e){var t,n=this.params;r.isArray(e)||(e=(e+"").split(","));for(var i=0;e.length>i&&!(t=a(n,e[i]));i++);return t},f=function(){return a(this,b)},d=function(){return a(this,"view")},l=function(){var e=this,t=e.hash,r=e.query;return t[b]!=r[b]},m=function(e){var t=this,r=t.hash,n=t.query;return r.params[e]!=n.params[e]},h=function(e){var t=this,r=t.hash;return a(r.params,e)},v=function(e){var t=this,r=t.query;return a(r.params,e)},p=function(e){var t=this,r=t.params;return r[e]};r.safeExec;var g=window,y=encodeURIComponent,x=decodeURIComponent,w="",b="pathname",$=i({qH:{},compareObject:function(e,t){var n=[];n=n.concat(r.keys(e)),n=n.concat(r.keys(t));for(var a=0;n.length>a;a++){var i=n[a];if(e[i]!=t[i])return!1}return!0},getRoutes:function(){var e=this;if(e.$pnr)return e.$pnr;var t={routes:c.routes||{}},r=c.defaultView;if(!r)throw Error("unset defaultView");t.home=r;var n=c.defaultPathname||w;return t.routes[n]=r,t[b]=n,t.nfView=c.notFoundView,e.$pnr=t},getViewPath:function(e){var t,n=this,a=n.getRoutes();return e||(e=a[b]),t=r.isFunction(a.routes)?a.routes(e):a.routes[e],{view:t?t:a.nfView||a.home,pathname:t?e:a.nfView?e:a[b]}},start:function(){var e=this;e.supportState()?e.useHistoryState():e.useLocationHash(),e.route()},supportState:function(){var e=g.history;return c.nativeHistory&&e.pushState&&e.replaceState},parsePath:function(e){var t=r.pathToObject(e),n=t[b],a=this;return"/"!=n.charAt(0)&&c.nativeHistory&&!a.supportState()&&(t[b]=r.path(g.location[b],n)),t},parseQueryAndHash:function(e){e=e||g.location.href;var t=this,r=t.qH;if(s)try{e=x(e)}catch(n){}if(a(r,e))return r[e];var o,c=e.replace(/^[^?#]+/g,function(e){return o=t.parsePath(e)[b],w}),u=o+c.replace(/^([^#]+).*$/g,"$1"),f=c.replace(/^[^#]*#?!?/g,w),d=t.parsePath(u),y=t.parsePath(f),$={};return i($,d.params),i($,y.params),r[e]={isPathnameDiff:l,isParamDiff:m,hashParamsOwn:h,queryParamsOwn:v,get:p,originalQuery:u,originalHash:f,query:d,hash:y,params:$}},parseLocation:function(e){var t,r=this,n=r.parseQueryAndHash(e);t=c.nativeHistory?n.hash[b]?n.hash[b]:n.query[b]:n.hash[b];var a=r.getViewPath(t);return i(n,a)},getChangedLocation:function(e,t){var n={params:{}};e[b]!=t[b]&&(n[b]=!0),e.view!=t.view&&(n.view=!0);var a=r.keys(e.params);a=a.concat(r.keys(t.params));for(var i=0;a.length>i;i++){var o=a[i];e.params[o]!==t.params[o]&&(n.params[o]=!0)}return n.isParam=u,n.isPathname=f,n.isView=d,n},route:function(){var e=this,t=e.parseLocation(),r=e.$lLoc||{params:{}},n=!e.$lLoc;e.$lLoc=t;var a,i=r.view||w;if(t.view==i?e.compareLocation(r,t)||(a=!0):a=!0,a){e.$tLoc=t;var o=e.getChangedLocation(r,t);e.fire("locationChanged",{location:t,changed:o,firstFire:n})}},compareLocation:function(e,t){return e[b]!=t[b]?!1:this.compareObject(e.params,t.params)},navigate2:function(e){var t=this;if(e&&r.isString(e)){var n=t.parsePath(e);if(n[b]){if(c.nativeHistory&&!t.supportState()){var s=t.$tLoc.query;if(s&&(s=s.params))for(var u in s)a(s,u)&&!a(n.params,u)&&(n.params[u]=w)}}else{var f=i({},t.$tLoc.params);f=i(f,n.params),n.params=f,n[b]=t.$tLoc[b]}if(!t.compareLocation(n,t.$tLoc)){t.$tLoc=n;var d=r.objectToPath(n);if(t.supportState())t.$firedPop=!0,history.pushState(new Date,o.title,d),t.route();else{var l=t.parseLocation(d);t.fire("locationChanged",{loc:l,slient:!0}),location.hash="#!"+d}}}},navigate:function(e,t){if(r.isObject(e)){var n=[];for(var a in e)n.push(a+"="+(s?y(e[a]):e[a]));e=n.join("&"),t&&(e=t+"?"+e)}this.navigate2(e)}},n);return r.mix($,t)},{requires:["magix/impl/router","magix/magix","magix/event"]}),KISSY.add("magix/vframe",function(e,t,r,n){var a=document,i=0,o=window,s=o.CollectGarbage||t.noop,c=t.safeExec,u=t.mix,f=t.cfg.tagName,d="mx-view",l=function(e){return"object"==typeof e?e:a.getElementById(e)},m=function(e,t){return l(e).getElementsByTagName(t)},h=function(e){return a.createElement(e)};h(f);var v="viewLoad",p=function(e){var t=this;t.rC=0,t.rM={},t.parentAlter();var r=t.view;c(r.fire,"childrenAlter",r),t.unmountZoneVframes(0,e)},g=/<script[^>]*>[\s\S]*?<\/script>/gi,y=function(e){var t=this;t.id=y.idIt(e),t.vId=t.id+"_view",t.cS={},t.cC=0,t.view=null,t.rC=0,t.rM={}};return u(y,{idIt:function(e){return e.id||(e.id="magix_vf_"+i++)},create:function(e,t){e=l(e);var r=new y(e);return u(r,t),r},createNode:function(e,t){var r=h(f);r.id=e,t.parentNode.insertBefore(r,t)}}),u(y.prototype,r),u(y.prototype,{useAnimUpdate:function(){return!1},oldViewDestroy:t.noop,prepareNextView:t.noop,newViewCreated:t.noop,mountView:function(e,r){var a=this,i=l(a.id);i._dataBak?i._dataChged=1:(i._dataBak=1,i._dataTmpl=i.innerHTML.replace(g,""));var o=a.$vN&&a.useAnimUpdate();if(a.unmountView(o,!0),e){var s=t.pathToObject(e),c=s.pathname;a.$vN=c;var f=function(e){if(c==a.$vN){n.prepare(e);var t;o?(t=a.vId,a.prepareNextView()):t=a.id;var f=new e({$:l,path:c,owner:a,ownerVOM:a.owner,id:t,vId:a.vId,vfId:a.id,location:a.owner.getLocation()});f.on("interact",function(e){a.fire(v,{view:f},a.vced=!0),o&&a.newViewCreated(!0),e.tmpl||(!o&&i._dataChged&&(i.innerHTML=i._dataTmpl),a.mountZoneVframes()),f.on("rendered",function(){a.mountZoneVframes()}),f.on("prerender",function(e){p.call(a,e.anim)})},0),a.view=f;var d=a.owner.getVframe(a.pId);d&&d.view&&(s.params.view=d.view),f.load(u(s.params,r,!0))}};t.libRequire(c,f)}},unmountView:function(e,t){var r=this,r=this;if(r.view){p.call(r,e),r.view.destroy(),r.vced=!1;var n=l(r.id);!e&&n._dataBak&&(n.innerHTML=n._dataTmpl),e&&t&&r.oldViewDestroy(),s(),delete r.view,delete r.viewName}else r.viewName&&(r.un(v),delete r.viewName)},mountZoneVframes:function(e,r,n){var a,i=this,o=i.owner;a=e?l(e):l(i.vId)||l(i.id);var s=m(a,f),c=s.length;if(c)for(var u,h,v=0;c>v;v++)u=s[v],h=u.getAttribute(d),u=y.create(u,{owner:i.owner,pId:i.id}),t.has(i.cS,u.id)||i.cC++,i.cS[u.id]=n,u.mountView(h,r),o.add(u);else i.childrenCreated()},unmountZoneVframes:function(e,r){var n,a=this;n=e?m(e,f):t.keys(a.cS);for(var i,o,s=0,c=n.length;c>s;s++)o=n[s],e&&(o=o.id),o&&(i=a.owner.getVframe(o),i.unmountView(r),a.owner.remove(o),l(o).id="",delete a.cS[o],a.cC--);e||(a.cS={},a.cC=0)},locationChanged:function(e){var r=this,n=r.view;if(n&&n.sign&&(n.location=e.location,n.rendered)){var a=n.olChanged(e),i=u({prevent:function(){this.cs=[]},toChildViews:function(e){e=e||[],t.isString(e)&&(e=e.split(",")),this.cs=e}},e);a&&c(n.locationChange,i,n);for(var o,s=i.cs||t.keys(r.cS),f=0,d=s.length,l=r.owner;d>f;f++)o=l.getVframe(s[f]),o&&o.locationChanged(e)}},locationUpdated:function(e){var r=this,n=r.view;if(n&&n.sign){n.location=e;var a,i=r.cS,o=r.owner;for(var s in i)t.has(i,s)&&(a=o.getVframe(s),a&&a.locationUpdated(e))}},childrenCreated:function(){var e=this,t=e.view;t&&!e.fcc&&(e.fcc=1,t.fire("childrenCreated"),e.fire("childrenCreated")),e.owner.childCreated(),e.parentAlter(!0)},parentAlter:function(e){var r=this,n=r.pId;if(n){var a=r.owner.getVframe(n);if(e)t.has(a.rM,r.id)||(a.rM[r.id]=a.cS[r.id],a.rC++,a.rC==a.cC&&(delete a.fca,a.childrenCreated()));else if(t.has(a.rM,r.id)){var i=a.rM[r.id];delete a.rM[r.id],a.rC--,i||a.fca||(a.fca=1,delete a.fcc,a.view.fire("childrenAlter"),a.fire("childrenAlter")),i||a.parentAlter(e)}}}}),y},{requires:["magix/magix","magix/event","magix/view"]}),KISSY.add("magix/view",function(e,t,r,n,a){var i=1,o=r.safeExec,s=r.has,c=",",u=[],f=r.cfg,d={render:1,renderUI:1,updateUI:1},l="~~",m=function(e){return function(){var t,r=this;return r.sign&&(r.sign++,r.fire("asyncall"),t=e.apply(r,arguments),r.fire("asyncalled")),t}},h=function(e){var t=this;r.mix(t,e),t.sign=1};h.prototype,r.mix(h,{idIt:function(e){return e.id||(e.id="magix_mxe_"+i++)},wrapAsyn:function(){var e=this;if(!e[l]){e[l]=1;var t,n=e.prototype;for(var a in n){t=n[a];var i=null;r.isFunction(t)&&t!=r.noop&&!t[l]&&s(d,a)&&(i=m(t),i[l]=t,n[a]=i)}}}});var v=h.prototype,p=window.CollectGarbage||r.noop,g=/\smx[a-z]+\s*=/g;return r.mix(v,n),r.mix(v,{render:r.noop,locationChange:r.noop,init:r.noop,hasTemplate:!0,enableEvent:!0,enableAnim:!1,load:function(){var e=this,t=e.hasTemplate,r=arguments,n=function(){e.delegateEvents(),e.fire("interact",{tmpl:t},!0),o(e.init,r,e),o(e.render,u,e);var n=!t&&!e.rendered;n&&(e.rendered=!0,e.fire("created",null,!0))};if(t){var a=e.sign;e.getTemplate(function(t){a==e.sign&&(e.template=t,n())})}else n()},updateViewId:function(){var e=this;e.id=e.$(e.vId)?e.vId:e.vfId},beginUpdateHTML:function(){var e=this;if(e.sign){var t=e.rendered;if(t){var r=e.enableAnim;e.fire("prerender",{anim:r});var n=e.owner;r&&(o(n.oldViewDestroy,u,n),o(n.prepareNextView,u,n),e.updateViewId())}}},endUpdateHTML:function(){var e=this;e.sign&&(e.rendered&&e.enableAnim&&o(owner.newViewCreated,u,owner),e.rendered||e.fire("created",null,!0),e.rendered=!0,e.fire("rendered"),p())},wrapMxEvent:function(e){return e?(e+"").replace(g,' mx-owner="'+this.vfId+'"$&'):e},setViewHTML:function(e){var t=this;t.beginUpdateHTML(),t.$(t.id).innerHTML=t.wrapMxEvent(e),t.endUpdateHTML()},observeLocation:function(e){var t=this;t.$loc||(t.$loc={}),r.isString(e)?t.$loc.keys=e.split(c):r.isArray(e)?t.$loc.keys=e:r.isObject(e)&&(t.$loc.pn=e.pathname,t.observeLocation(e.keys))},olChanged:function(e){var t=this,r=t.$loc,n=e.changed;if(r){var a=!1;if(r.pn&&(a=n.isPathname()),!a){var i=r.keys;a=n.isParam(i)}return a}return!0},destroy:function(){var e=this;e.fire("destroy",null,!0,!0),e.delegateEvents(!0),e.sign=0},getTemplate:function(e){var t=this;if(t.template)e(t.template);else{var n=r.tmpl(t.path);if(n)e(n);else{var a=f.debug,i=".html",o=f.appHome+t.path+i;a&&(o+="?_="+(new Date).getTime()+i),t.getTmplByXHR(o,function(n){e(r.tmpl(t.path,n))})}}},processEvent:function(e){var t=this;if(t.enableEvent&&t.sign){var r=e.target,n=e.current,a=e.info;e.type;var i=e.domEvent;if(a){var s,c=a.split(":"),u=c.shift(),f=c[c.length-1];("_halt_"==f||"_stop_"==f)&&(i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,s=!0),("_halt_"==f||"_prevent_"==f)&&(i.preventDefault?i.preventDefault():i.returnValue=!1,s=!0),s&&c.pop();for(var d,l=h.idIt(n),m=t.events,v=m[i.type],p=0;c.length>p;p++)d=c[p].lastIndexOf("@"),d>-1&&(c[c[p].substring(d+1)]=c[p].substring(0,d));v[u]&&o(v[u],{view:t,currentId:l,targetId:h.idIt(r),domEvent:i,events:m,params:c},v)}}},delegateEvents:function(e){var t=this,r=t.events,n=e?a.detachEvent:a.attachEvent;for(var i in r)n.call(a,i)},mountZoneViews:function(e,t,r){this.owner.mountZoneVframes(e,t,r!==!1)},unmountZoneViews:function(e){this.owner.unmountZoneVframes(e)},mountView:function(e,t,r){var n=this,a=n.ownerVOM,i=a.getVframe(e);return i&&i.mountView(t,r),i}}),r.mix(h,t,{prototype:!0}),r.mix(h.prototype,t.prototype),h},{requires:["magix/impl/view","magix/magix","magix/event","magix/body"]}),KISSY.add("magix/vom",function(e,t,r,n,a){var i=document;r.safeExec;var o,s="magix_vf_root",c=r.has,u=0,f=0,d=0,l=0,m={},h=r.mix({add:function(e){c(m,e.id)||(u++,m[e.id]=e,h.fire("add",{vframe:e}))},getVframe:function(e){return m[e]},remove:function(e){var t=r.isString(e)?e:e.id,e=m[t];e&&(u--,delete m[t],h.fire("remove",{vframe:e}))},childCreated:function(){if(!l){f++;var e=f/u;e>d&&(h.fire("progress",{percent:d=e}),1==e&&(l=1,h.un("progress")))}},getRoot:function(){var e=h.getVframe(s);if(!e){var r=i.getElementById(s);r||t.createNode(s,i.body.firstChild),e=t.create(s,{owner:h}),h.add(e)}return e},remountRoot:function(e){var t=h.getRoot();o=e.location,t.mountView(o.view)},locationChanged:function(e){o=e.location;var t=h.getRoot();t.locationChanged(e)},locationUpdated:function(e){o=e;var t=h.getRoot();t.locationUpdated(e)},getLocation:function(){return o}},n);return a.on("event",function(e){var t=h.getVframe(e.handler);t&&t.view&&t.view.processEvent(e)}),h},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]}),KISSY.add("mxext/mmanager",function(e,t){var r=t.has,n=t.safeExec,a=function(e){t.isArray(e)||(e=[e]);for(var r,n=0;e.length>n;n++)r=e[n],delete r.cacheKey;return e},i=function(e){var t=this;t.$modelClass=e},o=Array.prototype.slice,s={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},c=function(e){var t={};for(var r in e)s[r]||(t[r]=e[r]);return t},u=function(e,t){var r=o.call(arguments,2);return function(){return e.apply(t,r.concat(o.call(arguments)))}};t.mix(i,{create:function(e){if(!e)throw Error("MManager.create modelClass ungiven");return new i(e)}});var f={ALL:1,ANY:2,ONE:4},d=function(e){this.$host=e,this.$task=!1};return t.mix(d.prototype,{create:function(t){var a=this,i=a.$host;e.isString(t)&&(t={name:t});var o=i[t.name];if(!o)throw Error("Not found:"+t.name);var s,u=t.cacheKey||o.cacheKey,f=t.cacheTime||o.cacheTime||0;i.$modelsCache||(i.$modelsCache={});var d,l=i.$modelsCache,m=t.metaParams||[];return u&&r(l,u)?(s=l[u],f>0&&e.now()-s._doneAt>f&&(delete l[u],d=!0)):(s=new i.$modelClass(c(o)),s._after=o.after,s._cacheKey=u,s._meta=o,d=!0),s.metaParams=m,d&&(s.reset(),s.set(c(t)),s.setUrlParams(o.urlParams),s.setPostParams(o.postParams),s.setUrlParams(t.urlParams),s.setPostParams(t.postParams),e.isFunction(o.before)&&n(o.before,[s].concat(m),o)),{entity:s,needUpdate:d}},fetchModels:function(a,i,o,s,c){var d=this;if(d.$task)return d.next(function(e){e.fetchModels(a,i,o,s,c)}),d;d.$task=!0;var l=d.$host;l.$modelsCache||(l.$modelsCache={}),l.$modelsCacheKeys||(l.$modelsCacheKeys={}),d.$reqModels||(d.$reqModels={});var m=l.$modelsCache,h=l.$modelsCacheKeys,v=d.$reqModels;t.isArray(a)||(a=[a]);for(var p,g,y,x=a.length,w=0,b=[],$=function(t,a,u,l){if(!d.$destroy){w++,delete v[u.id];var y,$,C=u._cacheKey;if(a)p=l||"fetch data error @ mxext/mmanager line 199",c==f.ONE&&(u.set("msg",p),o&&(y=n(o,u)),$=!1);else{g=!0,b[t]=u,C&&!r(m,C)&&(m[C]=u);var M=u.metaParams;u._doneAt=e.now(),u._after&&n(u._after,[u].concat(M),u._meta),c==f.ONE&&(i&&(y=n(i,u)),$=!0)}if(C&&r(h,C)){var S=h[C];delete h[C],n(S,[a,u,l],u)}if(w>=x){if(c!=f.ONE){var E=p?o:i,l=p?[p]:b;$=!p,c==f.ANY&&(E=g?i:o,l=g?b:[p],$=g),y=n(E,l,d)}d.$ntId=setTimeout(function(){d.$task=!1,d.doNext(y,$)},30)}s&&n(s,{total:x,current:w,error:p})}},C=0;a.length>C;C++){y=a[C];var M,S,E=y.cacheKey;E&&r(h,E)?h[E].push(u($,d,C)):(S=d.create(y),M=S.entity,S.needUpdate?(v[M.id]=M,E&&(h[E]=[]),M.request({success:u($,M,C,!1,M),error:u($,M,C,!0,M)})):$(C,!1,M))}return d},fetchAll:function(e,t,r,n){return this.fetchModels(e,t,r,n,f.ALL)},saveAll:function(e,t,r,n){return e=a(e),this.fetchModels(e,t,r,n,f.ALL)},saveAny:function(e,t,r,n){return e=a(e),this.reqModels(e,t,r,n,f.ANY)},fetchAny:function(e,t,r,n){return this.reqModels(e,t,r,n,f.ANY)},saveOne:function(e,t,r,n){return e=a(e),this.reqModels(e,t,r,n,f.ONE)},fetchOne:function(e,t,r,n){return this.fetchModels(e,t,r,n,f.ONE)},abort:function(){var e=this;clearTimeout(e.$ntId);var t=e.$host,a=e.$reqModels,i=t.$modelsCacheKeys;if(a)for(var o in a){var s=a[o],c=s._cacheKey;if(c&&r(i,c)){var u=i[c];delete i[c],n(u,[!0,s,"aborted"],s)}s.abort()}e.$reqModels={},e.$queue=[],e.$task=!1},next:function(e){var t=this;if(t.$queue||(t.$queue=[]),t.$queue.push(e),!t.$task){var r=t.$latest||[null,!0];t.doNext.apply(t,r)}return t},doNext:function(e,t){var r=this,a=r.$queue;if(a){var i=a.shift();i&&n(i,[r,e,t],r)}r.$latest=[e,t]},destroy:function(){var e=this;e.$destroy=!0,e.abort()}}),t.mix(i.prototype,{registerModels:function(e){var r=this;t.isArray(e)||(e=[e]);for(var n,a=0;e.length>a;a++){if(n=e[a],!n.name)throw Error("model must own a name attribute");r[n.name]=n}},registerMethods:function(e){var a=this;for(var i in e)r(e,i)&&(a[i]=function(e){return function(){for(var r,i,o=arguments,s=[],c=0;o.length>c;c++)i=o[c],t.isFunction(i)?s.push(function(e){return function(){r||e.apply(e,arguments)}}(i)):s.push(i);var u=e.apply(a,s);return{abort:function(){u&&u.abort&&n(u.abort,["aborted"],u),r=!0}}}}(e[i]))},callMethods:function(t,r,n){for(var a,i,o=this,s=[],c="",u=t.length,f=0,d=function(t,i,o){a||(f++,o?c=t:s[i]=t,f>=u&&(c?e.isFunction(n)&&n(c):e.isFunction(r)&&r.apply(r,s)))},l=function(e,t){return function(r){d(r,e,!t)}},m=0;t.length>m;m++){i=t[m];var h;h=e.isFunction(i.name)?i.name:o[i.name],h?(i.params||(i.params=[]),e.isArray(i.params)||(i.params=[i.params]),i.params.push(l(m,!0),l(m)),h.apply(o,i.params)):d("unfound:"+i.name,m,!0)}return{abort:function(){a=!0}}},saveAll:function(e,t,r,n){return new d(this).saveAll(e,t,r,n)},fetchAll:function(e,t,r,n){return new d(this).fetchAll(e,t,r,n)},saveAny:function(e,t,r,n){return new d(this).saveAny(e,t,r,n)},fetchAny:function(e,t,r,n){return new d(this).fetchAny(e,t,r,n)},saveOne:function(e,t,r,n){return new d(this).saveOne(e,t,r,n)},fetchOne:function(e,t,r,n){return new d(this).fetchOne(e,t,r,n)},clearCacheByKey:function(t){var n=this,a=n.$modelsCache;if(a)if(e.isString(t))r(a,t)&&delete a[t];else if(e.isRegExp(t))for(var i in a)t.test(i)&&delete modelClass[i]},clearCacheByName:function(t){var r,n=this,a=n.$modelsCache;if(r=e.isRegExp(t)?function(e){return t.test(e)}:function(e){return e==t},a)for(var i in a){var o=a[i],s=o._meta;r(s.name)&&delete a[i]}},getModelUrl:function(t){var r,n=this;return r=e.isString(t)?n[t]:t,n.$modelClass.prototype.url(r.uri)}}),i},{requires:["magix/magix"]}),KISSY.add("mxext/model",function(e,t){var r=function(n,a,i){for(var o in a)e.isObject(a[o])?(t.has(n,o)||(n[o]={}),r(n[o],a[o],!0)):i&&(n[o]=a[o])},n=function(t){t&&this.set(t),this.id=e.guid("m")},a=function(n,a){var i=function(){i.superclass.constructor.apply(this,arguments),a&&t.safeExec(a,[],this)};return t.mix(i,this,{prototype:!0}),r(n,this.prototype),e.extend(i,this,n)};return t.mix(n,{GET:"GET",POST:"POST",extend:a}),t.mix(n.prototype,{urlMap:{},sync:t.noop,parse:t.noop,getParamsObject:function(e){return e||(e=n.GET),this["$"+e]||null},getUrlParamsObject:function(){return this.getParamsObject(n.GET)},getPostParamsObject:function(){return this.getParamsObject(n.POST)},getPostParams:function(){return this.getParams(n.POST)},getUrlParams:function(){return this.getParams(n.GET)},getParams:function(t){var r=this;t=t?t.toUpperCase():n.GET;var a,i="$"+t,o=r[i],s=[];if(o)for(var c in o)if(a=o[c],e.isArray(a))for(var u=0;a.length>u;u++)s.push(c+"="+encodeURIComponent(a[u]));else s.push(c+"="+encodeURIComponent(a));return s.join("&")},setUrlParamsIf:function(e,t){this.setParams(e,t,n.GET,!0)},setPostParamsIf:function(e,t){var r=this;r.setParams(e,t,n.POST,!0)},setParams:function(t,r,a,i){a=a?a.toUpperCase():n.GET;var o=this;o.$keysCache||(o.$keysCache={}),o.$keysCache[a]=!0;var s="$"+a;if(o[s]||(o[s]={}),e.isObject(t))for(var c in t)i&&o[s][c]||(o[s][c]=t[c]);else t&&r&&(i&&o[s][t]||(o[s][t]=r))},setPostParams:function(e,t){var r=this;r.setParams(e,t,n.POST)},setUrlParams:function(e,t){this.setParams(e,t,n.GET)},removeParamsObject:function(e){e||(e=n.GET),delete this["$"+e]},removePostParamsObject:function(){this.removeParamsObject(n.POST)},removeUrlParamsObject:function(){this.removeParamsObject(n.GET)},reset:function(){var e=this,r=e.$keysCache;if(r){for(var n in r)t.has(r,n)&&delete e["$"+n];delete e.$keysCache}var a=e.$keys,i=e.$attrs;if(a){for(var o=0;a.length>o;o++)delete i[a[o]];delete e.$keys}},url:function(e){var t,r=this,n=e||r.get("uri");if(!n)throw Error("model not set uri");t=n.split(":");var a=r.urlMap;if(a)for(var i=0,o=a,s=t.length;s>i&&(o=o[t[i]],void 0!==o);i++)i==s-1&&(n=o);return n},get:function(e){var t=this,r=t.$attrs;return r?r[e]:null},set:function(t,r,n){var a=this;if(a.$attrs||(a.$attrs={}),n&&!a.$keys&&(a.$keys=[]),e.isObject(t))for(var i in t)n&&a.$keys.push(i),a.$attrs[i]=t[i];else t&&(n&&a.$keys.push(t),a.$attrs[t]=r)},load:function(e){this.request(e)},save:function(e){this.request(e)},request:function(t){t||(t={});var r=t.success,n=t.error,a=this;a.$abort=!1,t.success=function(t){if(!a.$abort){if(t){var n=a.parse(t);n&&(e.isArray(n)&&(n={list:n}),a.set(n,null,!0))}r&&r.apply(this,arguments)}},t.error=function(){a.$abort||n&&n.apply(this,arguments)},a.$trans=a.sync(t)},abort:function(){var e=this;e.$trans&&e.$trans.abort&&e.$trans.abort(),delete e.$trans,e.$abort=!0},beginTransaction:function(){var t=this;t.$bakAttrs=e.clone(t.$attrs)},rollbackTransaction:function(){var e=this,t=e.$bakAttrs;t&&(e.$attrs=t,delete e.$bakAttrs)},endTransaction:function(){delete this.$bakAttrs}}),n},{requires:["magix/magix"]}),KISSY.add("mxext/view",function(e,t,r,n){var a,i=window,o=",",s="destroy,abort,stop,cancel,remove".split(o),c=0,u=Magix.safeExec,f=Magix.has,d={},l=function(e){if(!l.d){l.d=1,e.on("add",function(e){var t=e.vframe,r=d[t.id];if(r){for(var n=0;r.length>n;n++)m(t,r[n]);delete d[t.id]}}),e.on("remove",function(e){delete d[e.vframe.id]});var t=e.buildRoot();t.on("childrenCreated",function(){d={}})}},m=function(e,t){var r=e.view;r&&e.vced?u(r.receiveMessage,t,r):e.on("viewLoad",function(e){u(e.view.receiveMessage,t,e.view)})};return t.extend({queryEvents:null,navigate:function(e){r.navigate(e)},attachQueryEvents:function(){var r=this,n=r.queryEvents;if(n){r.$queryEventsCache={};for(var a in n){var i=n[a];for(var o in i)e.all("#"+r.id+" "+o).on(a,r.$queryEventsCache[a+"_"+o]=function(e){return function(a){if(r.enableEvent){var i=t.idIt(a.target),o=t.idIt(a.currentTarget);Magix.safeExec(e,{view:r,targetId:i,currentId:o,queryEvents:n,domEvent:a},n)}}}(i[o]))}}},detachQueryEvents:function(){var t=this,r=t.queryEvents;if(r){for(var n in r){var a=r[n];for(var i in a)e.all("#"+t.id+" "+i).detach(n,t.$queryEventsCache[n+"_"+i])}delete t.$queryEventsCache}},setData:function(e){this.data=this.wrapMustachData(e)},wrapMustachData:function(e){var t,r,n=this,a=this.renderer;if(a)for(t in a)for(r in a[t])(function(){var i=t,o=r,s=a[i][o];e[i+"_"+o]=function(){return s.call(this,n,i)}})();return e},manage:function(e,t){var r=this,n=arguments,a=!0;1==n.length&&(t=e,e="res_"+c++,a=!1),r.$resCache||(r.$resCache={});var i={hasKey:a,res:t};return r.$resCache[e]=i,t},getManaged:function(e){var t=this,r=t.$resCache;if(t.sign,r&&f(r,e)){var n=r[e],a=n.res;return a}return null},removeManaged:function(e){var t=this,r=null,n=t.$resCache;if(n)if(f(n,e))r=n[e].res,delete n[e];else for(var a in n)if(n[a].res===e){r=n[a].res,delete n[a];break}return r},destroyManaged:function(t){var r=this,n=r.$resCache;if(n){for(var a in n){var o=n[a],c=o.res;if(Magix.isNumber(c))i.clearTimeout(c),i.clearInterval(c);else if(c)if(c.nodeType&&c.parentNode)e.one(c).remove();else for(var f=0;s.length>f;f++)Magix.isFunction(c[s[f]])&&u(c[s[f]],[],c);t&&!o.hasKey&&delete n[a]}t||delete r.$resCache}},destroyAsyncall:function(){var e=this,t=e.$resCache;if(t)for(var r in t){var n=t[r],a=n.res;a.fetchOne&&a.fetchAll?(a.destroy(),delete t[r]):Magix.isNumber(a)&&(i.clearTimeout(a),i.clearInterval(a),delete t[r])}},receiveMessage:Magix.noop,postMessageTo:function(e,t){var r=this.ownerVOM;l(r),Magix.isArray(e)||(e=[e]),t||(t={});for(var n,a=0;e.length>a;a++){n=e[a];var i=r.get(n);i?m(i,t):(d[n]||(d[n]=[]),d[n].push(t))}},setViewPagelet:function(t,r){var n=this,i=n.sign,o=function(t){a?t(a):e.use("brix/core/pagelet",function(e,r){t(a=r)})},s=n.getManaged("pagelet");s?s.ready(function(){s.setChunkData(t)}):o(function(a){i==n.sign&&(e.one("#"+n.id).html(""),n.beginUpdateHTML(),s=new a({container:"#"+n.id,tmpl:n.wrapMxEvent(n.template),data:n.wrapMustachData(t),destroyAction:"empty"}),n.endUpdateHTML(),n.manage("pagelet",s),r&&(s.on("beforeRefreshTmpl",function(e){n.unmountZoneViews(e.node[0])}),s.ready(function(){i==n.sign&&r.call(n,s)})))})}},function(){var e=this;e.vm=new n,e.on("interact",function(){e.on("asyncall",function(){e.destroyAsyncall()}),e.on("prerender",function(){e.destroyManaged(!0),e.detachQueryEvents()}),e.on("rendered",function(){e.attachQueryEvents()}),e.on("destroy",function(){e.destroyManaged()})})})},{requires:["magix/view","magix/router","mxext/viewmodel"]}),KISSY.add("mxext/viewmodel",function(e){var t=function(e){t.superclass.constructor.call(this,e),this.addAttrs(e)};return e.extend(t,e.Base,{registerDataKey:function(e){for(var t={},r=0;e.length>r;r++)t[e[r]]={};this.addAttrs(t)},registerHelpers:function(e){var t=this.constructor.superclass.set;for(var r in e)t.call(this,r,e[r],{slient:!0})},toJSON:function(){return this.getAttrVals()},set:function(t,r,n){var a=t;e.isPlainObject(a)||(a={},a[t]=r);for(var i in a)if(!this.hasAttr(i))throw Error("The DataKey: '"+i+"' has not been registed in current ViewModel!");return this.constructor.superclass.set.call(this,t,r,n)}}),t},{requires:["base"]}),function(e){var t=function(){};e.console||(e.console={log:t,warn:t,error:t,debug:t});var r;e.Magix||(e.Magix={start:function(e){r=e}},KISSY.use("magix/magix",function(t,n){e.Magix=n,r&&n.start(r)}))}(this);