KISSY.add("magix/body",function(i,e,d,h){var i=d.mix,b={submit:1,focusin:1,focusout:1,mouseenter:1,mouseleave:1,mousewheel:1,change:1},j=document.body,l={},o=d.cfg.tagName,m={},h=i({processEvent:function(b){for(var d=b.target||b.srcElement;d&&1!=d.nodeType;)d=d.parentNode;var k=d,p=b.type,a=m[p]||(m[p]=RegExp("(?:^|,)"+p+"(?:,|$)"));if(!a.test(d.getAttribute("mx-ignore"))){for(var f="mx"+p,c,g,t=[];k&&k!=j&&!(c=k.getAttribute(f),g=k.getAttribute("mx-ignore"),c||a.test(g));)t.push(k),k=k.parentNode;
if(c){p=k.getAttribute("mx-handler")||k.getAttribute("mx-owner");if(!p)for(a=k;a&&a!=j;)if(a.tagName.toUpperCase()==o){k.setAttribute("mx-handler",p=a.id);break}else a=a.parentNode;if(p)this.fire("event",{info:c,type:f,domEvent:b,target:d,current:k,handler:p});else throw Error("miss mx-handler attribute:"+c);}else for(;t.length;)b=t.shift(),g=b.getAttribute("mx-ignore"),a.test(g)||(g=g?g+","+p:p,b.setAttribute("mx-ignore",g))}},attachEvent:function(d){var e=this;l[d]?l[d]++:(l[d]=1,b[d]?e.delegateUnbubble(j,
d):j["on"+d]=function(b){(b=b||window.event)&&e.processEvent(b)})},detachEvent:function(d){var e=l[d];0<e&&(e--,e?l[d]=e:(b[d]?this.undelegateUnbubble(j,d):j["on"+d]=null,delete l[d]))}},h);return d.mix(h,e)},{requires:["magix/impl/body","magix/magix","magix/event"]});
KISSY.add("magix/event",function(i,e){var d=e.safeExec;return{fire:function(e,b,j,l){var o="~`"+e,m=this[o];if(m){b||(b={});if(!b.type)b.type=e;for(var e=m.length-1,i=e+1,n;i--&&!(n=l?i:e-i,fn=m[n],fn.d&&(m.splice(n,1),e--),!1===d(fn,b,this)););}j&&delete this[o]},on:function(d,b,j){d="~`"+d;this[d]||(this[d]=[]);e.isNumeric(j)?this[d].splice(j,0,b):(b.d=j,this[d].push(b))},un:function(d,b){e.isArray(d)||(d=[d]);for(var j=0,i=d.length;j<i;j++){var o="~`"+d[j],m=this[o];if(m)if(b)for(var o=0,q=m.length;o<
q;o++){if(m[o]==b){m.splice(o,1);break}}else delete this[o]}}}},{requires:["magix/magix"]});KISSY.add("magix/impl/body",function(i){return{delegateUnbubble:function(e,d){var h=this;if(!h.$events)h.$events={};e=i.one(e);e.delegate(d,"*[mx"+d+"]",h.$events[d]=function(b){h.processEvent(b)})},undelegateUnbubble:function(e,d){var h=this.$events;h&&(e=i.one(e),e.undelegate(d,"*[mx"+d+"]",h[d]),delete h[d])}}},{requires:["node"]});
KISSY.add("magix/impl/magix",function(i){return{libRequire:function(e,d){if(e){var h=this.isFunction(d),b=this.isArray(e);i.use(b?e.join(","):e,h?function(b){d.apply(b,[].slice.call(arguments,1))}:this.noop)}else d()},libEnv:function(e){var d=this.cfg;if(e){var h=[],b=0,j,l=e.progress;if(l){var o=function(){var a=h.length;a?(8<a&&h.splice(0,2),Magix.safeExec(l,h.shift(),d),setTimeout(o,15)):h.d=0},m=function(a){if(a!=j&&(h.push(j=a),!h.d))h.d=setTimeout(o,15)};e.vomLoad=function(a){for(a=Math.max(a,
b);b<a;)b+=0.05*Math.random(),m(b=Math.min(b,a));b=a};var q=i.getScript;i.getScript=function(){if(0.95>=b)b+=0.04*Math.random();else if(1==b)i.getScript=q,h.s=1;m(b);q.apply(i,arguments)}}}else{var e=d.appHome||"./",n=location,k=n.protocol,p=d.appName||"app",e=e.replace(RegExp("(^|/)"+p+"/?$","i"),function(a,f){return f||"./"});~e.indexOf(k)||(e=this.path(n.href,e));i.endsWith(e,"/")||(e+="/");d.appHome=e;if(d.debug)d.debug=0==e.indexOf(k+"//"+n.host);d.debug&&1.3>Number(i.version)&&i.config({map:[[RegExp("("+
e+p+"/.+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]});n="";(n=d.debug?i.now():d.appTag)&&(n+=".js");k=d.appCombine;i.isUndefined(k)&&(k=i.config("combine"));i.config({packages:[{name:d.appName=p,path:e,debug:d.debug,combine:k,tag:n}]})}},isArray:i.isArray,isFunction:i.isFunction,isObject:i.isObject,isRegExp:i.isRegExp,isString:i.isString,isNumber:i.isNumber}});
KISSY.add("magix/impl/router",function(i){return{useHistoryState:function(){var e=this,d=location.href;i.one(window).on("popstate",function(){var i=location.href==d;if(e.$firedPop||!i)e.$firedPop=!0,e.route()})},useLocationHash:function(){var e=this;i.one(window).on("hashchange",function(){e.route()})}}},{requires:["node"]});
KISSY.add("magix/impl/view",function(i,e,d,h){var b=function(){},j={wrapAsyn:1,extend:1},l=function(b,d,e){for(var j in d)i.isObject(d[j])?(h.has(b,j)||(b[j]={}),l(b[j],d[j],!0)):e&&(b[j]=d[j])};b.extend=function(d,e){var j=function(){j.superclass.constructor.apply(this,arguments);e&&h.safeExec(e,arguments,this)};j.extend=b.extend;return i.extend(j,this,d)};b.prepare=function(b){if(!b.wrapAsyn){for(var d in this)h.has(j,d)&&(b[d]=this[d]);d=b.prototype;for(var e=b;e.superclass;)e=e.superclass.constructor,
l(d,e.prototype)}b.wrapAsyn()};h.mix(b.prototype,{getTmplByXHR:function(b,d){e({url:b,dataType:"html",success:function(b){d(b)},error:function(b,e){d(e)}})}});return b},{requires:["ajax","sizzle","magix/magix"]});
KISSY.add("magix/magix",function(i,e){var d=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,h=/[^\/]*$/,b=/[#?].*$/,j=/([^=&?\/#]+)=([^&=#?]*)/g,l=/^https?:\/\//i,o={},m=function(a,f){return!a?!1:Object.prototype.hasOwnProperty.call(a,f)},q=function(a,f,c){for(var g in f)if(!0===c)a[g]=f[g];else if(m(f,g)&&(!c||!m(c,g)))a[g]=f[g];return a},n=function(a,f,c,g,b,d){p.isArray(a)||(a=[a]);if(!f||!p.isArray(f)&&!f.callee)f=[f];for(g=0;g<a.length;g++)try{d=a[g],b=p.isFunction(d)&&d.apply(c,f)}catch(k){}return b},
k=function(){},p={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:q,has:m,safeExec:n,noop:k,cfg:{debug:false,tagName:"VFRAME"},locals:{},config:function(a){var f=this.cfg;a&&(f=q(f,a));return f},start:function(a){var f=this,a=f.config(a);f.libEnv();a.ready&&(n(a.ready),delete a.ready);var c=a.hasIniFile;(function(g){!1!==c?f.libRequire(a.appName+"/ini",g):g()})(function(c){f.cfg=q(a,c,a);var b={progress:f.cfg.progress,vomLoad:k};f.libEnv(b);f.libRequire(["magix/router","magix/vom"],
function(c,g){c.on("locationChanged",function(c){c.slient?g.locationUpdated(c.loc):c.changed.isView()?g.remountRoot(c):g.locationChanged(c)});g.on("progress",function(c){b.vomLoad(c.percent)});f.libRequire(a.extensions,function(){c.start()})})})},keys:function(a){var f;if(Object.keys)f=Object.keys(a);else{f=[];for(var c in a)m(a,c)&&f.push(c)}return f},local:function(a,f){var c=arguments,g=this.locals;if(0==c.length)return g;if(1==c.length)if(this.isObject(a))q(g,a);else return g[a];else g[a]=f},
path:function(a,f){var a=a.replace(b,"").replace(h,""),c="";"/"==f.charAt(0)?(c=a.indexOf("://"),-1==c?c=f:(c=a.indexOf("/",c+3),c=-1==c?a+f:a.substring(0,c)+f)):c=a+f;for(;d.test(c);)c=c.replace(d,"$1/");return c},pathToObject:function(a){var f={},c={},g="";b.test(a)?g=a.replace(b,""):~a.indexOf("=")||(g=a);if(g&&l.test(g))var d=g.indexOf("/",8),g=-1==d?"/":g.substring(d);a.replace(j,function(a,f,g){c[f]=g});f.pathname=g;f.params=c;return f},objectToPath:function(a){var f=a.pathname,c=[],g;for(g in a.params)m(a.params,
g)&&c.push(g+"="+a.params[g]);return f+(c.length?"?":"")+c.join("&")},tmpl:function(a,f){return 1==arguments.length?o[a]:o[a]=f}};return p.mix(p,e)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(i,e,d,h){var b=d.has,j=d.mix,l=document,o=/^UTF-8$/i.test(l.charset||l.characterSet||"UTF-8"),m=d.cfg,q=function(c){var a,f=this.params;d.isArray(c)||(c=(""+c).split(","));for(var g=0;g<c.length&&!(a=b(f,c[g]));g++);return a},n=function(){return b(this,r)},k=function(){return b(this,"view")},p=function(){return this.hash[r]!=this.query[r]},a=function(c){return this.hash.params[c]!=this.query.params[c]},f=function(c){return b(this.hash.params,c)},c=function(c){return b(this.query.params,
c)},g=function(c){return this.params[c]},t=window,x=encodeURIComponent,D=decodeURIComponent,r="pathname",i=j({qH:{},compareObject:function(c,a){for(var f=[],f=f.concat(d.keys(c)),f=f.concat(d.keys(a)),g=0;g<f.length;g++){var b=f[g];if(c[b]!=a[b])return!1}return!0},getRoutes:function(){if(this.$pnr)return this.$pnr;var c={routes:m.routes||{}},a=m.defaultView;if(!a)throw Error("unset defaultView");c.home=a;var f=m.defaultPathname||"";c.routes[f]=a;c[r]=f;c.nfView=m.notFoundView;return this.$pnr=c},
getViewPath:function(c){var a=this.getRoutes(),f;c||(c=a[r]);f=d.isFunction(a.routes)?a.routes(c):a.routes[c];return{view:f?f:a.nfView||a.home,pathname:f?c:a.nfView?c:a[r]}},start:function(){this.supportState()?this.useHistoryState():this.useLocationHash();this.route()},supportState:function(){var c=t.history;return m.nativeHistory&&c.pushState&&c.replaceState},parsePath:function(c){var c=d.pathToObject(c),a=c[r];"/"!=a.charAt(0)&&m.nativeHistory&&!this.supportState()&&(c[r]=d.path(t.location[r],
a));return c},parseQueryAndHash:function(d){var d=d||t.location.href,k=this,e=k.qH;if(o)try{d=D(d)}catch(i){}if(b(e,d))return e[d];var x,l=d.replace(/^[^?#]+/g,function(c){x=k.parsePath(c)[r];return""}),h=x+l.replace(/^([^#]+).*$/g,"$1"),l=l.replace(/^[^#]*#?!?/g,""),m=k.parsePath(h),n=k.parsePath(l),q={};j(q,m.params);j(q,n.params);return e[d]={isPathnameDiff:p,isParamDiff:a,hashParamsOwn:f,queryParamsOwn:c,get:g,originalQuery:h,originalHash:l,query:m,hash:n,params:q}},parseLocation:function(c){var c=
this.parseQueryAndHash(c),a=this.getViewPath(m.nativeHistory?c.hash[r]?c.hash[r]:c.query[r]:c.hash[r]);return j(c,a)},getChangedLocation:function(c,a){var f={params:{}};c[r]!=a[r]&&(f[r]=!0);if(c.view!=a.view)f.view=!0;for(var g=d.keys(c.params),g=g.concat(d.keys(a.params)),b=0;b<g.length;b++){var e=g[b];c.params[e]!==a.params[e]&&(f.params[e]=!0)}f.isParam=q;f.isPathname=n;f.isView=k;return f},route:function(){var c=this.parseLocation(),a=this.$lLoc||{params:{}},f=!this.$lLoc;this.$lLoc=c;var g;
c.view==(a.view||"")?this.compareLocation(a,c)||(g=!0):g=!0;if(g)this.$tLoc=c,a=this.getChangedLocation(a,c),this.fire("locationChanged",{location:c,changed:a,firstFire:f})},compareLocation:function(c,a){return c[r]!=a[r]?!1:this.compareObject(c.params,a.params)},navigate2:function(c){if(c&&d.isString(c)){c=this.parsePath(c);if(c[r]){if(m.nativeHistory&&!this.supportState()){var a=this.$tLoc.query;if(a&&(a=a.params))for(var f in a)b(a,f)&&!b(c.params,f)&&(c.params[f]="")}}else f=j({},this.$tLoc.params),
f=j(f,c.params),c.params=f,c[r]=this.$tLoc[r];if(!this.compareLocation(c,this.$tLoc))this.$tLoc=c,c=d.objectToPath(c),this.supportState()?(this.$firedPop=!0,history.pushState(new Date,l.title,c),this.route()):(this.fire("locationChanged",{loc:this.parseLocation(c),slient:!0}),location.hash="#!"+c)}},navigate:function(c,a){if(d.isObject(c)){var f=[],g;for(g in c)f.push(g+"="+(o?x(c[g]):c[g]));c=f.join("&");a&&(c=a+"?"+c)}this.navigate2(c)}},h);return d.mix(i,e)},{requires:["magix/impl/router","magix/magix",
"magix/event"]});
KISSY.add("magix/vframe",function(i,e,d,h){var b=document,j=0,l=window.CollectGarbage||e.noop,o=e.safeExec,m=e.mix,q=e.cfg.tagName,n=function(a){return"object"==typeof a?a:b.getElementById(a)};b.createElement(q);var k=function(a){this.rC=0;this.rM={};this.parentAlter();var c=this.view;o(c.fire,"childrenAlter",c);this.unmountZoneVframes(0,a)},p=/<script[^>]*>[\s\S]*?<\/script>/ig,a=function(f){this.id=a.idIt(f);this.vId=this.id+"_view";this.cS={};this.cC=0;this.view=null;this.rC=0;this.rM={}};m(a,
{idIt:function(a){return a.id||(a.id="magix_vf_"+j++)},create:function(f,c){var f=n(f),g=new a(f);m(g,c);return g},createNode:function(a,c){var g=b.createElement(q);g.id=a;c.parentNode.insertBefore(g,c)}});m(a.prototype,d);m(a.prototype,{useAnimUpdate:function(){return!1},oldViewDestroy:e.noop,prepareNextView:e.noop,newViewCreated:e.noop,mountView:function(a,c){var g=this,b=n(g.id);b._dataBak?b._dataChged=1:(b._dataBak=1,b._dataTmpl=b.innerHTML.replace(p,""));var d=g.$vN&&g.useAnimUpdate();g.unmountView(d,
!0);if(a){var j=e.pathToObject(a),i=j.pathname;g.$vN=i;e.libRequire(i,function(a){if(i==g.$vN){h.prepare(a);var f;d?(f=g.vId,g.prepareNextView()):f=g.id;var e=new a({$:n,path:i,owner:g,ownerVOM:g.owner,id:f,vId:g.vId,vfId:g.id,location:g.owner.getLocation()});e.on("interact",function(c){g.fire("viewLoad",{view:e},g.vced=!0);d&&g.newViewCreated(!0);if(!c.tmpl){if(!d&&b._dataChged)b.innerHTML=b._dataTmpl;g.mountZoneVframes()}e.on("rendered",function(){g.mountZoneVframes()});e.on("prerender",function(c){k.call(g,
c.anim)})},0);g.view=e;if((a=g.owner.getVframe(g.pId))&&a.view)j.params.view=a.view;e.load(m(j.params,c,!0))}})}},unmountView:function(a,c){var g=this,g=this;if(g.view){k.call(g,a);g.view.destroy();g.vced=!1;var b=n(g.id);if(!a&&b._dataBak)b.innerHTML=b._dataTmpl;a&&c&&g.oldViewDestroy();l();delete g.view;delete g.viewName}else g.viewName&&(g.un("viewLoad"),delete g.viewName)},mountZoneVframes:function(f,c,g){var b=this.owner,f=f?n(f):n(this.vId)||n(this.id),f=n(f).getElementsByTagName(q),d=f.length;
if(d)for(var k=0,p,j;k<d;k++)p=f[k],j=p.getAttribute("mx-view"),p=a.create(p,{owner:this.owner,pId:this.id}),e.has(this.cS,p.id)||this.cC++,this.cS[p.id]=g,p.mountView(j,c),b.add(p);else this.childrenCreated()},unmountZoneVframes:function(a,c){var g;g=a?n(a).getElementsByTagName(q):e.keys(this.cS);for(var b,d,k=0,p=g.length;k<p;k++){d=g[k];if(a)d=d.id;if(d)b=this.owner.getVframe(d),b.unmountView(c),this.owner.remove(d),n(d).id="",delete this.cS[d],this.cC--}if(!a)this.cS={},this.cC=0},locationChanged:function(a){var c=
this.view;if(c&&c.sign&&(c.location=a.location,c.rendered)){var g=c.olChanged(a),b=m({prevent:function(){this.cs=[]},toChildViews:function(c){c=c||[];e.isString(c)&&(c=c.split(","));this.cs=c}},a);g&&o(c.locationChange,b,c);for(var c=b.cs||e.keys(this.cS),g=0,b=c.length,d=this.owner,k;g<b;g++)(k=d.getVframe(c[g]))&&k.locationChanged(a)}},locationUpdated:function(a){var c=this.view;if(c&&c.sign){c.location=a;var c=this.cS,g,b=this.owner,d;for(d in c)e.has(c,d)&&(g=b.getVframe(d))&&g.locationUpdated(a)}},
childrenCreated:function(){var a=this.view;if(a&&!this.fcc)this.fcc=1,a.fire("childrenCreated"),this.fire("childrenCreated");this.owner.childCreated();this.parentAlter(!0)},parentAlter:function(a){var c=this.pId;if(c)if(c=this.owner.getVframe(c),a)e.has(c.rM,this.id)||(c.rM[this.id]=c.cS[this.id],c.rC++,c.rC==c.cC&&(delete c.fca,c.childrenCreated()));else if(e.has(c.rM,this.id)){var b=c.rM[this.id];delete c.rM[this.id];c.rC--;if(!b&&!c.fca)c.fca=1,delete c.fcc,c.view.fire("childrenAlter"),c.fire("childrenAlter");
b||c.parentAlter(a)}}});return a},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(i,e,d,h,b){var j=1,l=d.safeExec,o=d.has,m=[],q=d.cfg,n={render:1,renderUI:1,updateUI:1},k=function(c){return function(){var a;this.sign&&(this.sign++,this.fire("asyncall"),a=c.apply(this,arguments),this.fire("asyncalled"));return a}},p=function(c){d.mix(this,c);this.sign=1};d.mix(p,{idIt:function(c){return c.id||(c.id="magix_mxe_"+j++)},wrapAsyn:function(){if(!this["~~"]){this["~~"]=1;var c=this.prototype,a,f;for(f in c){a=c[f];var b=null;d.isFunction(a)&&a!=d.noop&&
!a["~~"]&&o(n,f)&&(b=k(a),b["~~"]=a,c[f]=b)}}}});var i=p.prototype,a=window.CollectGarbage||d.noop,f=/\smx[a-z]+\s*=/g;d.mix(i,h);d.mix(i,{render:d.noop,locationChange:d.noop,init:d.noop,hasTemplate:!0,enableEvent:!0,enableAnim:!1,load:function(){var c=this,a=c.hasTemplate,f=arguments,b=function(){c.delegateEvents();c.fire("interact",{tmpl:a},!0);l(c.init,f,c);l(c.render,m,c);if(!a&&!c.rendered)c.rendered=!0,c.fire("created",null,!0)};if(a){var d=c.sign;c.getTemplate(function(a){if(d==c.sign)c.template=
a,b()})}else b()},updateViewId:function(){this.id=this.$(this.vId)?this.vId:this.vfId},beginUpdateHTML:function(){if(this.sign&&this.rendered){var c=this.enableAnim;this.fire("prerender",{anim:c});var a=this.owner;c&&(l(a.oldViewDestroy,m,a),l(a.prepareNextView,m,a),this.updateViewId())}},endUpdateHTML:function(){if(this.sign)this.rendered&&this.enableAnim&&l(owner.newViewCreated,m,owner),this.rendered||this.fire("created",null,!0),this.rendered=!0,this.fire("rendered"),a()},wrapMxEvent:function(c){return c?
(""+c).replace(f,' mx-owner="'+this.vfId+'"$&'):c},setViewHTML:function(c){this.beginUpdateHTML();this.$(this.id).innerHTML=this.wrapMxEvent(c);this.endUpdateHTML()},observeLocation:function(c){if(!this.$loc)this.$loc={};if(d.isString(c))this.$loc.keys=c.split(",");else if(d.isArray(c))this.$loc.keys=c;else if(d.isObject(c))this.$loc.pn=c.pathname,this.observeLocation(c.keys)},olChanged:function(c){var a=this.$loc,c=c.changed;if(a){var f=!1;a.pn&&(f=c.isPathname());f||(f=c.isParam(a.keys));return f}return!0},
destroy:function(){this.fire("destroy",null,!0,!0);this.delegateEvents(!0);this.sign=0},getTemplate:function(c){var a=this;if(a.template)c(a.template);else{var f=d.tmpl(a.path);f?c(f):(f=q.appHome+a.path+".html",q.debug&&(f+="?_="+(new Date).getTime()+".html"),a.getTmplByXHR(f,function(f){c(d.tmpl(a.path,f))}))}},processEvent:function(c){if(this.enableEvent&&this.sign){var a=c.target,f=c.current,b=c.info,c=c.domEvent;if(b){var b=b.split(":"),d=b.shift(),k=b[b.length-1],e;if("_halt_"==k||"_stop_"==
k)c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,e=!0;if("_halt_"==k||"_prevent_"==k)c.preventDefault?c.preventDefault():c.returnValue=!1,e=!0;e&&b.pop();f=p.idIt(f);e=this.events;for(var k=e[c.type],j=0,i;j<b.length;j++)i=b[j].lastIndexOf("@"),-1<i&&(b[b[j].substring(i+1)]=b[j].substring(0,i));k[d]&&l(k[d],{view:this,currentId:f,targetId:p.idIt(a),domEvent:c,events:e,params:b},k)}}},delegateEvents:function(c){var a=this.events,c=c?b.detachEvent:b.attachEvent,f;for(f in a)c.call(b,f)},mountZoneViews:function(c,
a,f){this.owner.mountZoneVframes(c,a,!1!==f)},unmountZoneViews:function(c){this.owner.unmountZoneVframes(c)},mountView:function(c,a,f){(c=this.ownerVOM.getVframe(c))&&c.mountView(a,f);return c}});d.mix(p,e,{prototype:!0});d.mix(p.prototype,e.prototype);return p},{requires:["magix/impl/view","magix/magix","magix/event","magix/body"]});
KISSY.add("magix/vom",function(i,e,d,h,b){var j=document,l=d.has,o=0,m=0,q=0,n=0,k={},p,a=d.mix({add:function(f){l(k,f.id)||(o++,k[f.id]=f,a.fire("add",{vframe:f}))},getVframe:function(a){return k[a]},remove:function(f){var c=d.isString(f)?f:f.id;if(f=k[c])o--,delete k[c],a.fire("remove",{vframe:f})},childCreated:function(){if(!n){m++;var f=m/o;q<f&&(a.fire("progress",{percent:q=f}),1==f&&(n=1,a.un("progress")))}},getRoot:function(){var f=a.getVframe("magix_vf_root");f||(j.getElementById("magix_vf_root")||
e.createNode("magix_vf_root",j.body.firstChild),f=e.create("magix_vf_root",{owner:a}),a.add(f));return f},remountRoot:function(f){var c=a.getRoot();p=f.location;c.mountView(p.view)},locationChanged:function(f){p=f.location;a.getRoot().locationChanged(f)},locationUpdated:function(f){p=f;a.getRoot().locationUpdated(f)},getLocation:function(){return p}},h);b.on("event",function(f){var c=a.getVframe(f.handler);c&&c.view&&c.view.processEvent(f)});return a},{requires:["magix/vframe","magix/magix","magix/event",
"magix/body"]});
KISSY.add("mxext/mmanager",function(i,e){var d=e.has,h=e.safeExec,b=function(b){e.isArray(b)||(b=[b]);for(var d=0,a;d<b.length;d++)a=b[d],delete a.cacheKey;return b},j=function(b){this.$modelClass=b},l=Array.prototype.slice,o={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},m=function(b){var d={},a;for(a in b)o[a]||(d[a]=b[a]);return d},q=function(b,d){var a=l.call(arguments,2);return function(){return b.apply(d,a.concat(l.call(arguments)))}};e.mix(j,{create:function(b){if(!b)throw Error("MManager.create modelClass ungiven");return new j(b)}});
var n=function(b){this.$host=b;this.$task=!1};e.mix(n.prototype,{create:function(b){var e=this.$host;i.isString(b)&&(b={name:b});var a=e[b.name];if(!a)throw Error("Not found:"+b.name);var f=b.cacheKey||a.cacheKey,c=b.cacheTime||a.cacheTime||0;if(!e.$modelsCache)e.$modelsCache={};var g=e.$modelsCache,j=b.metaParams||[],l;f&&d(g,f)?(e=g[f],0<c&&i.now()-e._doneAt>c&&(delete g[f],l=!0)):(e=new e.$modelClass(m(a)),e._after=a.after,e._cacheKey=f,e._meta=a,l=!0);e.metaParams=j;l&&(e.reset(),e.set(m(b)),
e.setUrlParams(a.urlParams),e.setPostParams(a.postParams),e.setUrlParams(b.urlParams),e.setPostParams(b.postParams),i.isFunction(a.before)&&h(a.before,[e].concat(j),a));return{entity:e,needUpdate:l}},fetchModels:function(b,j,a,f,c){var g=this;if(g.$task)return g.next(function(d){d.fetchModels(b,j,a,f,c)}),g;g.$task=!0;var l=g.$host;if(!l.$modelsCache)l.$modelsCache={};if(!l.$modelsCacheKeys)l.$modelsCacheKeys={};if(!g.$reqModels)g.$reqModels={};var o=l.$modelsCache,m=l.$modelsCacheKeys,n=g.$reqModels;
e.isArray(b)||(b=[b]);for(var C=b.length,z=0,u,A=[],y,l=function(b,e,k,l){if(!g.$destroy){z++;delete n[k.id];var t=k._cacheKey,q,s;e?(u=l||"fetch data error @ mxext/mmanager line 199",4==c&&(k.set("msg",u),a&&(q=h(a,k)),s=!1)):(y=!0,A[b]=k,t&&!d(o,t)&&(o[t]=k),b=k.metaParams,k._doneAt=i.now(),k._after&&h(k._after,[k].concat(b),k._meta),4==c&&(j&&(q=h(j,k)),s=!0));t&&d(m,t)&&(b=m[t],delete m[t],h(b,[e,k,l],k));if(z>=C)4!=c&&(e=u?a:j,l=u?[u]:A,s=!u,2==c&&(e=y?j:a,l=y?A:[u],s=y),q=h(e,l,g)),g.$ntId=
setTimeout(function(){g.$task=!1;g.doNext(q,s)},30);f&&h(f,{total:C,current:z,error:u})}},v=0,s;v<b.length;v++){s=b[v];var w=s.cacheKey,B;w&&d(m,w)?m[w].push(q(l,g,v)):(B=g.create(s),s=B.entity,B.needUpdate?(n[s.id]=s,w&&(m[w]=[]),s.request({success:q(l,s,v,!1,s),error:q(l,s,v,!0,s)})):l(v,!1,s))}return g},fetchAll:function(b,d,a,f){return this.fetchModels(b,d,a,f,1)},saveAll:function(d,e,a,f){d=b(d);return this.fetchModels(d,e,a,f,1)},saveAny:function(d,e,a,f){d=b(d);return this.reqModels(d,e,a,
f,2)},fetchAny:function(b,d,a,f){return this.reqModels(b,d,a,f,2)},saveOne:function(d,e,a,f){d=b(d);return this.reqModels(d,e,a,f,4)},fetchOne:function(b,d,a,f){return this.fetchModels(b,d,a,f,4)},abort:function(){clearTimeout(this.$ntId);var b=this.$reqModels,e=this.$host.$modelsCacheKeys;if(b)for(var a in b){var f=b[a],c=f._cacheKey;if(c&&d(e,c)){var g=e[c];delete e[c];h(g,[!0,f,"aborted"],f)}f.abort()}this.$reqModels={};this.$queue=[];this.$task=!1},next:function(b){if(!this.$queue)this.$queue=
[];this.$queue.push(b);this.$task||this.doNext.apply(this,this.$latest||[null,!0]);return this},doNext:function(b,d){var a=this.$queue;a&&(a=a.shift())&&h(a,[this,b,d],this);this.$latest=[b,d]},destroy:function(){this.$destroy=!0;this.abort()}});e.mix(j.prototype,{registerModels:function(b){e.isArray(b)||(b=[b]);for(var d=0,a;d<b.length;d++){a=b[d];if(!a.name)throw Error("model must own a name attribute");this[a.name]=a}},registerMethods:function(b){var j=this,a;for(a in b)d(b,a)&&(j[a]=function(a){return function(){for(var c,
b=arguments,d=[],k=0,l;k<b.length;k++)l=b[k],e.isFunction(l)?d.push(function(a){return function(){c||a.apply(a,arguments)}}(l)):d.push(l);var i=a.apply(j,d);return{abort:function(){i&&i.abort&&h(i.abort,["aborted"],i);c=!0}}}}(b[a]))},callMethods:function(b,d,a){for(var f=[],c="",e=b.length,j=0,l,h=function(b,k,h){l||(j++,h?c=b:f[k]=b,e<=j&&(c?i.isFunction(a)&&a(c):i.isFunction(d)&&d.apply(d,f)))},m=function(a,c){return function(b){h(b,a,!c)}},o=0,n;o<b.length;o++){n=b[o];var q;if(q=i.isFunction(n.name)?
n.name:this[n.name]){if(!n.params)n.params=[];if(!i.isArray(n.params))n.params=[n.params];n.params.push(m(o,!0),m(o));q.apply(this,n.params)}else h("unfound:"+n.name,o,!0)}return{abort:function(){l=!0}}},saveAll:function(b,d,a,f){return(new n(this)).saveAll(b,d,a,f)},fetchAll:function(b,d,a,f){return(new n(this)).fetchAll(b,d,a,f)},saveAny:function(b,d,a,f){return(new n(this)).saveAny(b,d,a,f)},fetchAny:function(b,d,a,f){return(new n(this)).fetchAny(b,d,a,f)},saveOne:function(b,d,a,f){return(new n(this)).saveOne(b,
d,a,f)},fetchOne:function(b,d,a,f){return(new n(this)).fetchOne(b,d,a,f)},clearCacheByKey:function(b){var e=this.$modelsCache;if(e)if(i.isString(b))d(e,b)&&delete e[b];else if(i.isRegExp(b))for(var a in e)b.test(a)&&delete modelClass[a]},clearCacheByName:function(b){var d=this.$modelsCache,a;a=i.isRegExp(b)?function(a){return b.test(a)}:function(a){return a==b};if(d)for(var f in d)a(d[f]._meta.name)&&delete d[f]},getModelUrl:function(b){return this.$modelClass.prototype.url((i.isString(b)?this[b]:
b).uri)}});return j},{requires:["magix/magix"]});
KISSY.add("mxext/model",function(i,e){var d=function(b,j,l){for(var h in j)i.isObject(j[h])?(e.has(b,h)||(b[h]={}),d(b[h],j[h],!0)):l&&(b[h]=j[h])},h=function(b){b&&this.set(b);this.id=i.guid("m")};e.mix(h,{GET:"GET",POST:"POST",extend:function(b,j){var l=function(){l.superclass.constructor.apply(this,arguments);j&&e.safeExec(j,[],this)};e.mix(l,this,{prototype:!0});d(b,this.prototype);return i.extend(l,this,b)}});e.mix(h.prototype,{urlMap:{},sync:e.noop,parse:e.noop,getParamsObject:function(b){if(!b)b=
h.GET;return this["$"+b]||null},getUrlParamsObject:function(){return this.getParamsObject(h.GET)},getPostParamsObject:function(){return this.getParamsObject(h.POST)},getPostParams:function(){return this.getParams(h.POST)},getUrlParams:function(){return this.getParams(h.GET)},getParams:function(b){var b=b?b.toUpperCase():h.GET,b=this["$"+b],d=[],e;if(b)for(var o in b)if(e=b[o],i.isArray(e))for(var m=0;m<e.length;m++)d.push(o+"="+encodeURIComponent(e[m]));else d.push(o+"="+encodeURIComponent(e));return d.join("&")},
setUrlParamsIf:function(b,d){this.setParams(b,d,h.GET,!0)},setPostParamsIf:function(b,d){this.setParams(b,d,h.POST,!0)},setParams:function(b,d,e,o){e=e?e.toUpperCase():h.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[e]=!0;e="$"+e;this[e]||(this[e]={});if(i.isObject(b))for(var m in b){if(!o||!this[e][m])this[e][m]=b[m]}else if(b&&d&&(!o||!this[e][b]))this[e][b]=d},setPostParams:function(b,d){this.setParams(b,d,h.POST)},setUrlParams:function(b,d){this.setParams(b,d,h.GET)},removeParamsObject:function(b){if(!b)b=
h.GET;delete this["$"+b]},removePostParamsObject:function(){this.removeParamsObject(h.POST)},removeUrlParamsObject:function(){this.removeParamsObject(h.GET)},reset:function(){var b=this.$keysCache;if(b){for(var d in b)e.has(b,d)&&delete this["$"+d];delete this.$keysCache}b=this.$keys;d=this.$attrs;if(b){for(var i=0;i<b.length;i++)delete d[b[i]];delete this.$keys}},url:function(b){var b=b||this.get("uri"),d;if(b){d=b.split(":");var e=this.urlMap;if(e)for(var i=0,h=d.length;i<h&&!(e=e[d[i]],void 0===
e);i++)i==h-1&&(b=e)}else throw Error("model not set uri");return b},get:function(b){var d=this.$attrs;return d?d[b]:null},set:function(b,d,e){if(!this.$attrs)this.$attrs={};if(e&&!this.$keys)this.$keys=[];if(i.isObject(b))for(var h in b)e&&this.$keys.push(h),this.$attrs[h]=b[h];else b&&(e&&this.$keys.push(b),this.$attrs[b]=d)},load:function(b){this.request(b)},save:function(b){this.request(b)},request:function(b){b||(b={});var d=b.success,e=b.error,h=this;h.$abort=!1;b.success=function(b){if(!h.$abort){if(b){var e=
h.parse(b);e&&(i.isArray(e)&&(e={list:e}),h.set(e,null,!0))}d&&d.apply(this,arguments)}};b.error=function(){h.$abort||e&&e.apply(this,arguments)};h.$trans=h.sync(b)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},beginTransaction:function(){this.$bakAttrs=i.clone(this.$attrs)},rollbackTransaction:function(){var b=this.$bakAttrs;if(b)this.$attrs=b,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});return h},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(i,e,d,h){var b=window,j="destroy,abort,stop,cancel,remove".split(","),l=0,o=Magix.safeExec,m=Magix.has,q,n={},k=function(a){if(!k.d)k.d=1,a.on("add",function(a){var a=a.vframe,c=n[a.id];if(c){for(var b=0;b<c.length;b++)p(a,c[b]);delete n[a.id]}}),a.on("remove",function(a){delete n[a.vframe.id]}),a.buildRoot().on("childrenCreated",function(){n={}})},p=function(a,b){var c=a.view;if(c&&a.vced)o(c.receiveMessage,b,c);else a.on("viewLoad",function(a){o(a.view.receiveMessage,
b,a.view)})};return e.extend({queryEvents:null,navigate:function(a){d.navigate(a)},attachQueryEvents:function(){var a=this,b=a.queryEvents;if(b){a.$queryEventsCache={};for(var c in b){var d=b[c],h;for(h in d)i.all("#"+a.id+" "+h).on(c,a.$queryEventsCache[c+"_"+h]=function(c){return function(d){if(a.enableEvent){var g=e.idIt(d.target),h=e.idIt(d.currentTarget);Magix.safeExec(c,{view:a,targetId:g,currentId:h,queryEvents:b,domEvent:d},b)}}}(d[h]))}}},detachQueryEvents:function(){var a=this.queryEvents;
if(a){for(var b in a){var c=a[b],d;for(d in c)i.all("#"+this.id+" "+d).detach(b,this.$queryEventsCache[b+"_"+d])}delete this.$queryEventsCache}},setData:function(a){this.data=this.wrapMustachData(a)},wrapMustachData:function(a){var b=this,c=this.renderer,d,e;if(c)for(d in c)for(e in c[d])(function(){var h=d,i=e,j=c[h][i];a[h+"_"+i]=function(){return j.call(this,b,h)}})();return a},manage:function(a,b){var c=!0;1==arguments.length&&(b=a,a="res_"+l++,c=!1);if(!this.$resCache)this.$resCache={};this.$resCache[a]=
{hasKey:c,res:b};return b},getManaged:function(a){var b=this.$resCache;return b&&m(b,a)?b[a].res:null},removeManaged:function(a){var b=null,c=this.$resCache;if(c)if(m(c,a))b=c[a].res,delete c[a];else for(var d in c)if(c[d].res===a){b=c[d].res;delete c[d];break}return b},destroyManaged:function(a){var d=this.$resCache;if(d){for(var c in d){var e=d[c],h=e.res;if(Magix.isNumber(h))b.clearTimeout(h),b.clearInterval(h);else if(h)if(h.nodeType&&h.parentNode)i.one(h).remove();else for(var k=0;k<j.length;k++)Magix.isFunction(h[j[k]])&&
o(h[j[k]],[],h);a&&!e.hasKey&&delete d[c]}a||delete this.$resCache}},destroyAsyncall:function(){var a=this.$resCache;if(a)for(var d in a){var c=a[d].res;c.fetchOne&&c.fetchAll?(c.destroy(),delete a[d]):Magix.isNumber(c)&&(b.clearTimeout(c),b.clearInterval(c),delete a[d])}},receiveMessage:Magix.noop,postMessageTo:function(a,b){var c=this.ownerVOM;k(c);Magix.isArray(a)||(a=[a]);b||(b={});for(var d=0,e;d<a.length;d++){e=a[d];var h=c.get(e);h?p(h,b):(n[e]||(n[e]=[]),n[e].push(b))}},setViewPagelet:function(a,
b){var c=this,d=c.sign,e=function(a){q?a(q):i.use("brix/core/pagelet",function(b,c){a(q=c)})},h=c.getManaged("pagelet");h?h.ready(function(){h.setChunkData(a)}):e(function(e){d==c.sign&&(i.one("#"+c.id).html(""),c.beginUpdateHTML(),h=new e({container:"#"+c.id,tmpl:c.wrapMxEvent(c.template),data:c.wrapMustachData(a),destroyAction:"empty"}),c.endUpdateHTML(),c.manage("pagelet",h),b&&(h.on("beforeRefreshTmpl",function(a){c.unmountZoneViews(a.node[0])}),h.ready(function(){d==c.sign&&b.call(c,h)})))})}},
function(){var a=this;a.vm=new h;a.on("interact",function(){a.on("asyncall",function(){a.destroyAsyncall()});a.on("prerender",function(){a.destroyManaged(!0);a.detachQueryEvents()});a.on("rendered",function(){a.attachQueryEvents()});a.on("destroy",function(){a.destroyManaged()})})})},{requires:["magix/view","magix/router","mxext/viewmodel"]});
KISSY.add("mxext/viewmodel",function(i){var e=function(d){e.superclass.constructor.call(this,d);this.addAttrs(d)};i.extend(e,i.Base,{registerDataKey:function(d){for(var e={},b=0;b<d.length;b++)e[d[b]]={};this.addAttrs(e)},registerHelpers:function(d){var e=this.constructor.superclass.set,b;for(b in d)e.call(this,b,d[b],{slient:!0})},toJSON:function(){return this.getAttrVals()},set:function(d,e,b){var j=d;i.isPlainObject(j)||(j={},j[d]=e);for(var l in j)if(!this.hasAttr(l))throw Error("The DataKey: '"+
l+"' has not been registed in current ViewModel!");return this.constructor.superclass.set.call(this,d,e,b)}});return e},{requires:["base"]});(function(i){var e=function(){};if(!i.console)i.console={log:e,warn:e,error:e,debug:e};var d;if(!i.Magix)i.Magix={start:function(e){d=e}},KISSY.use("magix/magix",function(e,b){i.Magix=b;d&&b.start(d)})})(this);